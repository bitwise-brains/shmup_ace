#include "game.h"
#include "game_math.h"
#include "projectile.h"
#include "player.h"
#include "enemy.h"
#include "explosion.h"

// Display
static tView *s_pView; // View containing all the viewports
static tVPort *s_pGameViewport; // Viewport for playfield
static tVPort *s_pHudViewport; // Viewport for HUD
static tTileBufferManager *s_pTileBuffer;
static tSimpleBufferManager *s_pHudBuffer;
static tCameraManager *s_pCamera;
static UWORD s_uwFadePalette[16][32] = {0};
static UBYTE s_ubDimLevel = 0;
static UBYTE s_ubFrameCounter = 0;
static UBYTE s_ubFlashTimer = 0;
static UBYTE s_ubFlashOn = FALSE;
static UBYTE s_ubLevelStart = TRUE;
static UBYTE s_ubLevelStartTimer = 128;

// Audio
static tPtplayerMod *s_pGameMusic;
static tPtplayerSfx *s_pSfxLightLaser;
static tPtplayerSfx *s_pSfxHeavyLaser;
static tPtplayerSfx *s_pSfxFastLaser;
static tPtplayerSfx *s_pSfxExplosion;
static tPtplayerSfx *s_pSfxCollect;

// Level
static tBitMap *s_pTiles;
static UBYTE s_ubCameraCanMove = FALSE;
static UBYTE s_ubMoveCameraCounter = 0;
static UBYTE s_ubCurrentLevel = 0;

// HUD
static tFont *s_pFont;
static tTextBitMap *s_pHudScoreText;
static tTextBitMap *s_pHudLivesText;
static tTextBitMap *s_pHudSpecialText;
static tTextBitMap *s_pHudPowerText;
static tBitMap *s_pHudIconsImage;
static tBitMap *s_pHudIconsMask;

static ULONG s_ulPlayerScore = 0; 
static UBYTE s_ubPlayerLives = PLAYER_LIVES_START;
static UBYTE s_ubPlayerSpecial = PLAYER_SPECIAL_START;
static UBYTE s_ubUpdateScore = TRUE;
static UBYTE s_ubUpdatePower = TRUE;
static UBYTE s_ubUpdateLives = TRUE;
static UBYTE s_ubUpdateSpecial = TRUE;

// Player
static tUwCoordYX s_tPlayerPosition;
static tBob s_tPlayerBob;
static tBitMap *s_pPlayerImage;
static tBitMap *s_pPlayerMask;
static tBob s_tEngineBob;
static tBitMap *s_pEngineImage;
static tBitMap *s_pEngineMask;
static UBYTE s_ubEngineAnimFrame = 0;
static UBYTE s_ubFireDelay = 0;
static UBYTE s_ubSpecialDelay = 0;
static UBYTE s_ubAudioDelay = 0;
static UBYTE s_ubEquippedProjectileType = 0;
static UBYTE s_ubPlayerAlive = FALSE;
static UBYTE s_ubPlayerMovedLeft = FALSE;
static UBYTE s_ubPlayerMovedRight = FALSE;
static UBYTE s_ubPlayerMovedOnY = FALSE;
static UBYTE s_ubDisplayPlayer = TRUE;
static UBYTE s_ubDisplayEngine = TRUE;
static UBYTE s_ubPlayerIsInvincible = FALSE;
static UBYTE s_ubPlayerInvincibleTimer = 0;

// Enemies
static tEnemy s_tEnemy[ENEMY_MAX] = {0};
static tBitMap *s_pEnemyImage;
static tBitMap *s_pEnemyMask;
static UBYTE s_ubWaveIndex = 0;
static UBYTE s_ubActiveEnemies = 0;

// Explosions
static tExplosion s_tExplosions[EXPLOSIONS_MAX] = {0};
static UBYTE s_ubActiveExplosions = 0;
static tBitMap *s_pSmallExplosionImage;
static tBitMap *s_pSmallExplosionMask;

// Big Explosion
static tBob s_tBigExplosionBob;
static UBYTE s_ubBigExplosionActive = 0;
static UBYTE s_ubBigExplosionFrame = 0;
static tBitMap *s_pBigExplosionImage;
static tBitMap *s_pBigExplosionMask;

// Powerups
static tBitMap *s_pPowerupsImage;
static tBitMap *s_pPowerupsMask;
static tBob s_tLifePowBob;
static tBob s_tSpecialPowBob;
static tBob s_tWeaponPowBob;
static UBYTE s_ubLifePowActive = FALSE;
static UBYTE s_ubSpecialPowActive = FALSE;
static UBYTE s_ubWeaponPowActive = FALSE;

// Player Projectiles
static tPlayerProjectile s_tPlayerProjectiles[PLAYER_PROJECTILE_MAX] = {0};
static tSprite *s_pPlayerProjectileSprites[PLAYER_PROJECTILE_TYPES] = {0};
static tBitMap *s_pPlayerProjectileImages[PLAYER_PROJECTILE_TYPES] = {0};
// static tPlayerSecondaryProjectile s_tPlayerSecondaryProjectiles[PLAYER_PROJECTILE_MAX] = {0};
// static tSprite *s_pPlayerSecondaryProjectileSprites[PLAYER_SECONDARY_PROJECTILE_TYPES];
// static tBitMap *s_pPlayerSecondaryProjectileImages[PLAYER_SECONDARY_PROJECTILE_TYPES] = {0};

// Enemy Projectiles
static tSprite *s_pEnemyProjectileSprite[ENEMY_SPRITE_CHANNELS] = {0};
static tBob s_tEnemyProjectileBob[ENEMY_BOB_CHANNELS] = {0};
static UBYTE s_ubEnemyProjectileBobTypes[ENEMY_BOB_CHANNELS] = {0};
static UBYTE s_ubProjectileBobIndex = 0;

  // fix16
static tComplexEnemyProjectile s_tComplexEnemyProjectiles[ENEMY_PROJECTILE_MAX] = {0};
static tComplexChannelBounds s_fComplexChannelBounds[ENEMY_SPRITE_CHANNELS] = {0};
static fix16_t s_fViewportXMin = 0;
static fix16_t s_fViewportXMax = 0;
static fix16_t s_fBoundsMax = 0;
static fix16_t s_fBoundsMin = 0;

  // UWORD
static tSimpleEnemyProjectile s_tSimpleEnemyProjectiles[ENEMY_PROJECTILE_MAX] = {0};
static tSimpleChannelBounds s_tSimpleChannelBounds[ENEMY_SPRITE_CHANNELS] = {0};

static tBitMap *s_pEnemyProjectileBobsImage;
static tBitMap *s_pEnemyProjectileBobsMask;
static tBitMap *s_pEnemyProjectileSpriteImage[ENEMY_PROJECTILE_TYPES];

// Text
static tBob s_tTextGameOverBob;
static tBitMap *s_pTextGameOverImage;
static tBitMap *s_pTextGameOverMask;
static UBYTE s_ubShowTextGameOver = FALSE;
static UBYTE s_ubShowTextGameOverTimer = 255;

static tBob s_tTextReadyBob;
static tBitMap *s_pTextReadyImage;
static tBitMap *s_pTextReadyMask;
static UBYTE s_ubShowTextReady = FALSE;

static tBob s_tTextGoBob;
static tBitMap *s_pTextGoImage;
static tBitMap *s_pTextGoMask;
static UBYTE s_ubShowTextGo = FALSE;

// Lookups

// Bitmaps
static UWORD s_uwEngineAnimOffset[] = {0, 0, 50, 50, 100, 100, 150, 150}; // 16x1==10
static UWORD s_uwSmallExplosionAnimOffset[] = {0, 0, 160, 160, 320, 320, 480, 480, 640, 640, 800, 800, 960, 960, 1120, 1120, 1280, 1280}; // 16x16
static UWORD s_uwBigExplosionAnimOffset[] = {0, 0, 0, 640, 640, 640, 1280, 1280, 1280, 1920, 1920, 1920, 2560, 2560, 2560, 3200, 3200, 3200, 3840, 3840, 3840, 4480, 4480, 4480}; // 32x32
static UWORD s_uwEnemyBitmapOffset[] = {0, 160, 320, 480, 640, 800};
static UWORD s_uwEnemyProjectileBitmapOffset[] = {0, 140, 280, 420};

// Level
static UBYTE s_ubMapData[] = {0,0,1,2,3,3,4,5,6,7,3,8,0,0,0,0,9,10,11,12,13,14,10,11,3,12,0,0,0,0,9,15,16,17,18,19,15,16,20,17,0,0,0,0,21,22,23,24,25,26,27,1,26,28,0,0,0,0,29,30,30,30,30,31,21,9,31,32,0,0,0,0,5,33,33,33,34,35,5,36,37,38,0,0,0,0,35,5,33,24,39,40,30,17,41,5,0,0,0,0,16,29,30,30,42,17,41,28,33,5,0,0,0,0,1,43,44,9,45,5,5,5,33,5,0,0,0,0,9,23,29,30,42,33,33,33,46,47,0,0,0,0,25,48,5,33,45,33,5,33,33,49,0,0,0,0,5,48,33,33,45,33,33,5,5,6,0,0,0,0,25,50,51,52,42,24,28,14,53,10,0,0,0,0,33,48,33,5,45,5,54,19,55,15,0,0,0,0,36,37,46,47,34,35,5,26,27,56,0,0,0,0,17,41,5,33,39,40,29,30,30,29,0,0,0,0,51,52,52,52,52,52,52,57,58,24,0,0,0,0,54,28,33,25,33,33,59,60,61,28,0,0,0,0,54,5,28,25,5,28,59,36,37,33,0,0,0,0,29,30,30,42,30,30,42,17,41,33,0,0,0,0,28,26,44,9,9,22,23,28,28,33,0,0,0,0,5,48,5,62,63,52,51,52,52,52,0,0,0,0,25,48,5,6,64,28,24,33,5,24,0,0,0,0,36,37,14,45,24,25,25,25,25,5,0,0,0,0,17,41,19,45,33,5,28,33,5,65,0,0,0,0,62,63,31,42,24,28,33,33,33,14,0,0,0,0,6,64,28,45,5,33,33,33,5,19,0,0,0,0,45,25,28,45,5,66,24,46,47,1,0,0,0,0,45,5,33,45,24,67,68,67,33,1,0,0,0,0,45,25,33,42,69,70,44,71,65,9,0,0,0,0,34,35,5,45,72,1,1,73,54,1,0,0,0,0,39,40,42,45,74,75,1,71,24,9,0,0,0,0,57,58,76,45,5,74,1,77,65,76,0,0,0,0,60,61,1,42,5,78,1,1,79,76,0,0,0,0,25,50,1,45,33,54,80,44,71,44,0,0,0,0,5,48,81,82,5,67,74,83,73,1,0,0,0,0,25,48,84,85,33,24,24,28,65,9,0,0,0,0,36,37,65,33,49,86,87,88,24,1,0,0,0,0,17,41,5,66,6,7,8,89,5,9,0,0,0,0,5,28,14,53,10,11,12,13,28,76,0,0,0,0,33,5,19,55,15,16,17,18,5,44,0,0,0,0,33,33,26,27,56,43,90,28,28,1,0,0,0,0,5,65,31,21,22,23,25,66,5,1,0,0,0,0,51,52,52,51,52,57,58,24,65,9,0,0,0,0,5,33,5,65,5,60,61,54,28,1,0,0,0,0,25,46,47,32,91,5,50,5,5,9,0,0,0,0,25,33,33,38,92,65,48,24,5,26,0,0,0,0,5,5,5,5,5,36,37,28,65,31,0,0,0,0,29,30,29,29,30,17,41,33,33,5,0,0,0,0,93,94,94,87,88,28,24,28,33,95,0,0,0,0,96,97,97,8,89,65,65,54,33,98,0,0,0,0,99,100,100,12,13,33,5,5,5,48,0,0,0,0,101,20,20,17,18,24,28,33,5,50,0,0,0,0,27,56,43,90,25,54,54,5,65,50,0,0,0,0,22,23,52,57,58,33,69,68,79,102,0,0,0,0,5,5,5,60,61,24,78,44,71,103,0,0,0,0,33,32,91,5,50,65,74,83,73,5,0,0,0,0,33,38,92,5,48,28,24,33,5,54,0,0,0,0,5,5,5,36,37,49,86,87,88,14,0,0,0,0,29,29,30,17,41,6,7,8,89,19,0,0,0,0,5,33,33,14,53,10,11,12,13,26,0,0,0,0,33,33,66,19,55,15,16,17,18,31,0,0,0,0,33,5,24,26,27,56,43,28,33,24,0,0,0,0,69,104,79,31,21,22,23,90,33,33,0,0,0,0,79,44,105,77,106,54,33,5,14,53,0,0,0,0,104,105,107,9,108,5,24,28,19,55,0,0,0,0,78,105,109,71,49,86,87,88,26,27,0,0,0,0,47,71,110,73,6,7,8,89,31,21,0,0,0,0,72,108,14,53,10,11,12,13,28,62,0,0,0,0,74,71,19,55,15,16,17,18,5,6,0,0,0,0,73,108,26,27,56,43,33,5,33,42,0,0,0,0,69,74,31,21,22,23,24,28,33,45,0,0,0,0,33,69,5,62,63,51,52,57,58,34,0,0,0,0,33,28,33,6,64,25,25,60,61,39,0,0,0,0,33,33,5,42,25,111,112,25,50,33,0,0,0,0,33,46,47,45,25,113,114,25,48,46,0,0,0,0,69,68,79,34,35,25,25,36,37,5,0,0,0,0,78,44,71,39,40,29,30,17,41,28,0,0,0,0,74,83,73,33,5,5,48,5,95,115,0,0,0,0,5,5,28,33,33,5,50,33,98,116,0,0,0,0,25,25,33,54,33,28,50,24,48,117,0,0,0,0,5,33,28,33,24,33,48,33,50,118,0,0,0,0,28,24,33,5,119,28,50,24,50,120,0,0,0,0,119,5,24,28,74,5,50,5,48,121,0,0,0,0,74,5,25,33,24,5,48,24,50,122,0,0,0,0,79,123,28,33,25,5,50,33,50,24,0,0,0,0,44,77,71,5,33,28,50,24,48,33,0,0,0,0,124,125,126,54,33,5,48,5,102,127,0,0,0,0,108,54,72,71,46,47,50,33,103,122,0,0,0,0,128,104,129,77,130,33,50,33,5,24,0,0,0,0,107,9,131,1,132,33,48,24,28,59,0,0,0,0,0,133,134,135,136,28,102,127,5,28,0,0,0,0,137,109,76,1,138,28,103,122,52,57,0,0,0,0,139,76,1,140,71,25,33,24,65,60,0,0,0,0,74,105,141,142,130,28,33,33,59,28,0,0,0,0,5,44,135,105,132,25,65,24,33,33,0,0,0,0,143,139,105,135,144,136,5,32,91,24,0,0,0,0,69,143,142,145,135,77,65,38,92,5,0,0,0,0,68,146,130,147,105,9,130,65,33,33,0,0,0,0,105,1,132,28,147,142,132,33,33,24,0,0,0,0,44,148,108,54,25,54,25,33,24,33,0,0,0,0,149,150,33,5,33,5,33,5,119,28,0,0,0,0,5,5,24,28,54,25,54,28,74,5,0,0,0,0,24,28,28,33,33,151,152,33,33,5,0,0,0,0,5,25,33,5,65,32,91,24,46,47,0,0,0,0,65,33,46,47,5,38,92,33,69,68,0,0,0,0,29,30,153,154,28,155,156,24,78,44,0,0,0,0,111,112,0,157,5,158,159,65,74,83,0,0,0,0,113,114,0,42,5,155,156,24,33,5,0,0,0,0,160,161,0,45,5,158,159,5,59,65,0,0,0,0,162,163,0,164,165,166,167,5,65,33,0,0,0,0,168,169,0,170,171,29,30,29,30,29,0,0,0,0,172,173,0,0,0,0,0,0,0,0,0,0,0,0,111,112,174,175,176,175,176,177,111,112,0,0,0,0,113,114,178,179,180,179,180,181,113,114,0,0,0,0,0,0,0,0,0,0,0,0,160,161,0,0,0,0,0,0,0,0,0,0,0,0,162,163,0,0,0,0,0,0,0,0,0,0,0,0,168,169,0,0,0,0,0,0,0,0,0,0,0,0,172,173,0,0,0,0,0,111,112,174,175,176,175,176,111,112,0,0,0,0,0,113,114,178,179,180,179,180,113,114,0,0,0,0,0,160,161,0,0,0,0,0,160,161,0,0,0,0,0,162,163,0,0,0,0,0,162,163,0,0,0,0,0,168,169,0,0,0,0,0,168,169,0,0,0,0,0,162,163,0,0,0,0,0,162,163,0,0,0,0,0,168,169,0,0,0,0,0,168,169,0,0,0,0,0,172,173,0,0,0,0,0,162,163,0,0,0,0,177,111,112,174,175,176,175,176,168,169,0,0,0,0,181,113,114,178,179,180,179,180,162,163,0,0,0,0,0,160,161,0,0,0,0,0,168,169,0,0,0,0,0,162,163,0,0,0,0,0,172,173,0,0,0,0,0,168,169,0,0,0,0,0,0,0,0,0,0,0,0,162,163,0,0,0,0,0,0,0,0,0,0,0,0,168,169,0,0,0,0,0,0,0,0,0,0,0,182,172,173,0,0,0,0,0,183,184,0,0,0,0,52,52,51,52,185,186,0,0,187,188,0,0,0,0,65,24,28,54,60,189,0,0,190,65,0,0,0,0,51,51,57,58,54,50,0,0,190,25,0,0,0,0,65,5,60,61,28,48,0,0,2,65,0,0,0,0,86,87,88,50,33,50,0,0,190,33,0,0,0,0,7,8,89,48,5,48,0,0,190,25,0,0,0,0,100,3,191,37,33,102,182,192,82,33,0,0,0,0,3,100,191,41,33,103,122,84,85,33,0,0,0,0,100,97,191,33,33,5,65,33,5,5,0,0,0,0,100,97,191,5,32,91,5,24,32,91,0,0,0,0,193,100,4,5,38,92,33,65,38,92,0,0,0,0,194,193,191,5,24,28,28,65,33,33,0,0,0,0,54,97,191,62,63,51,52,57,58,46,0,0,0,0,100,12,13,6,64,65,5,60,61,65,0,0,0,0,195,17,18,2,95,115,153,154,50,52,0,0,0,0,196,50,24,190,98,197,198,157,48,65,0,0,0,0,25,50,65,2,102,127,199,82,50,33,0,0,0,0,33,48,33,190,103,122,84,85,48,65,0,0,0,0,36,37,33,2,33,5,33,65,50,65,0,0,0,0,17,41,33,190,33,59,54,28,48,65,0,0,0,0,5,33,65,34,35,33,28,36,37,28,0,0,0,0,5,32,91,39,40,29,30,17,41,33,0,0,0,0,33,38,92,33,65,5,2,33,5,33,0,0,0,0,33,28,24,24,24,65,190,5,54,5,0,0,0,0,33,33,95,115,153,154,34,35,25,25,0,0,0,0,5,5,98,116,200,157,39,40,29,30,0,0,0,0,47,28,48,201,117,190,5,5,33,5,0,0,0,0,91,33,50,105,1,2,33,95,115,153,0,0,0,0,92,28,50,3,117,2,65,98,202,0,0,0,0,0,33,33,102,121,81,82,33,102,182,192,0,0,0,0,154,65,103,122,84,85,5,103,122,84,0,0,0,0,157,62,63,57,58,5,33,5,5,5,0,0,0,0,82,6,64,60,61,33,59,33,25,25,0,0,0,0,85,34,35,36,37,33,33,5,5,5,0,0,0,0,65,39,40,17,41,33,62,63,51,51,0,0,0,0,5,33,33,5,33,33,6,64,25,25,0,0,0,0,79,138,33,33,54,5,2,5,62,63,0,0,0,0,65,75,68,71,5,199,82,33,6,64,0,0,0,0,203,1,105,77,204,84,85,28,2,33,0,0,0,0,205,135,1,119,66,5,33,33,190,32,0,0,0,0,206,149,75,110,5,32,91,33,2,38,0,0,0,0,5,28,24,28,46,38,92,28,190,54,0,0,0,0,62,63,57,58,33,33,24,28,2,32,0,0,0,0,6,64,60,61,33,33,33,33,190,38,0,0,0,0,34,35,36,37,33,33,33,5,2,5,0,0,0,0,39,40,17,41,33,5,46,47,34,35,0,0,0,0,5,5,5,66,62,63,57,58,39,40,0,0,0,0,87,88,33,5,6,64,60,61,5,33,0,0,0,0,8,89,28,33,2,33,33,48,33,62,0,0,0,0,54,191,29,30,190,33,5,48,5,6,0,0,0,0,3,4,24,28,2,24,28,50,30,2,0,0,0,0,193,191,51,52,190,49,86,93,93,94,0,0,0,0,193,4,25,25,2,6,7,193,96,193,0,0,0,0,193,191,29,30,190,10,11,194,99,194,0,0,0,0,194,4,57,58,2,15,16,101,20,101,0,0,0,0,193,191,60,61,2,76,1,26,9,190,0,0,0,0,194,4,5,50,190,44,9,31,9,2,0,0,0,0,97,4,24,48,34,35,36,37,33,190,0,0,0,0,12,13,5,102,39,40,17,41,5,2,0,0,0,0,17,18,33,103,122,51,52,51,52,190,0,0,0,0,33,5,24,28,5,49,86,87,88,2,0,0,0,0,54,5,32,91,24,6,7,8,89,190,0,0,0,0,5,28,38,92,24,2,54,54,191,2,0,0,0,0,47,28,24,24,14,190,194,194,4,190,0,0,0,0,49,86,87,88,19,2,193,193,191,190,0,0,0,0,6,7,8,89,1,190,194,194,4,2,0,0,0,0,2,54,54,191,9,2,96,97,191,190,0,0,0,0,190,194,194,4,31,190,99,100,4,51,0,0,0,0,2,193,193,191,9,2,193,193,191,207,0,0,0,0,190,194,194,4,1,190,194,194,4,75,0,0,0,0,2,193,193,191,9,2,193,193,191,73,0,0,0,0,190,194,194,4,30,190,194,194,4,29,0,0,0,0,2,96,97,191,9,2,96,97,191,190,0,0,0,0,190,99,100,4,1,190,99,100,4,2,0,0,0,0,2,193,193,191,9,2,193,193,191,190,0,0,0,0,190,96,97,4,1,190,194,194,4,2,0,0,0,0,2,99,100,191,9,2,96,97,191,190,0,0,0,0,190,99,100,4,1,190,99,100,4,190,0,0,0,0,2,96,97,191,9,2,193,193,191,34,0,0,0,0,190,99,100,4,1,190,194,194,4,39,0,0,0,0,2,193,193,191,9,2,3,3,4,5,0,0,0,0,190,194,194,4,1,10,11,12,13,5,0,0,0,0,2,193,193,191,9,15,16,17,18,24,0,0,0,0,190,194,194,4,27,56,43,90,33,33,0,0,0,0,2,3,3,4,21,22,23,5,33,5,0,0,0,0,10,11,12,13,28,62,63,51,52,57,0,0,0,0,15,16,17,18,65,6,64,5,5,60,0,0,0,0,21,22,23,24,33,42,5,32,91,5,0,0,0,0,5,28,33,28,54,45,28,38,92,5,0,0,0,0,5,33,65,28,65,34,35,5,5,36,0,0,0,0,33,33,28,24,24,39,40,29,30,17,0,0,0,0,5,5,33,54,24,65,28,33,5,28,0,0,0,0,5,28,24,5,5,5,54,49,86,87,0,0,0,0,62,63,51,52,57,58,5,6,7,8,0,0,0,0,6,64,25,25,60,61,53,10,11,12,0,0,0,0,42,25,33,59,25,50,55,15,16,17,0,0,0,0,45,25,59,33,25,48,27,56,43,90,0,0,0,0,34,35,25,25,36,37,21,22,23,65,0,0,0,0,39,40,29,30,17,41,24,33,33,24,0,0,0,0,65,24,28,54,33,5,5,5,33,33,0,0,0,0,5,33,24,33,65,3,54,24,33,3,0,0,0,0,33,33,33,5,33,5,65,33,5,33,0,0,0,0,54,24,65,5,24,54,5,46,47,65,0,0,0,0,5,95,115,29,30,30,29,30,30,153,0,0,0,0,5,98,116,200,157,5,28,98,116,200,0,0,0,0,65,48,201,117,190,33,5,48,201,117,0,0,0,0,28,50,105,1,2,65,33,50,105,1,0,0,0,0,5,50,3,117,2,5,33,50,117,3,0,0,0,0,5,102,121,81,82,208,208,102,121,81,0,0,0,0,28,103,122,84,85,32,91,103,122,84,0,0,0,0,5,33,5,65,5,38,92,33,5,65,0,0,0,0,30,29,30,153,154,155,156,33,33,28,0,0,0,0,86,87,88,198,157,158,159,33,5,24,0,0,0,0,7,8,89,24,42,155,156,24,25,33,0,0,0,0,11,12,13,33,42,158,159,24,24,3,0,0,0,0,16,17,18,24,42,155,156,95,115,29,0,0,0,0,43,5,33,199,45,158,159,98,197,28,0,0,0,0,0,209,210,133,42,155,156,50,69,68,0,0,0,0,117,3,201,117,190,158,159,48,78,44,0,0,0,0,118,209,211,212,2,155,156,48,74,110,0,0,0,0,120,213,214,118,2,155,156,50,5,28,0,0};

// Path and tilemap.
static UWORD s_uwPathOffset[] = {   0, 1026, 2052, 3846, 5640, 7434, 9228, 10766};
static UWORD s_uwPathLength[] = {1026, 1026, 1794, 1794, 1794, 1794, 1538,  1538};
static UWORD s_uwPathData[] = {16,128,16,128,16,127,16,127,16,127,16,127,16,126,16,126,16,126,16,125,16,125,16,125,16,124,16,124,16,124,16,123,16,123,16,123,16,122,16,122,16,121,16,121,16,121,16,120,16,120,16,119,16,119,16,118,16,118,16,118,16,117,16,117,16,116,16,116,16,115,16,115,16,114,16,114,16,113,16,113,16,112,16,112,16,111,16,111,16,110,16,110,16,109,16,109,16,108,16,107,16,107,16,106,16,106,16,105,16,105,16,104,16,104,16,103,16,102,16,102,16,101,16,101,16,100,16,100,16,99,16,98,16,98,16,97,16,97,16,96,16,96,16,95,16,94,16,94,16,93,16,93,16,92,16,91,16,91,16,90,16,90,16,89,16,88,16,88,16,87,16,87,16,86,16,86,16,85,16,84,16,84,16,83,16,83,16,82,16,82,16,81,16,80,16,80,16,79,16,79,16,78,16,78,16,77,16,76,16,76,16,75,16,75,16,74,16,74,16,73,16,73,16,72,16,72,16,71,16,71,16,70,16,70,16,69,16,69,16,68,16,68,16,67,16,67,16,66,16,66,16,65,16,65,16,64,16,64,16,64,16,63,16,63,16,62,16,62,16,61,16,61,16,60,16,60,16,60,16,59,16,59,16,58,15,58,15,57,15,57,15,57,15,56,15,56,15,55,15,55,15,54,15,54,15,53,15,53,14,53,14,52,14,52,14,51,14,51,14,50,14,50,14,50,14,49,13,49,13,48,13,48,13,47,13,47,13,46,13,46,13,46,12,45,12,45,12,44,12,44,12,43,12,43,12,43,12,42,11,42,11,41,11,41,11,41,11,40,11,40,11,39,11,39,11,39,10,38,10,38,10,37,10,37,10,37,10,36,10,36,10,35,10,35,10,35,9,34,9,34,9,33,9,33,9,33,9,32,9,32,9,31,9,31,9,31,9,30,9,30,9,30,9,29,9,29,9,29,9,28,9,28,9,28,9,27,9,27,9,26,9,26,9,26,9,25,9,25,9,25,9,24,9,24,9,24,10,24,10,23,10,23,10,23,10,22,10,22,10,22,10,21,11,21,11,21,11,21,11,20,11,20,12,20,12,19,12,19,12,19,13,19,13,18,13,18,13,18,14,18,14,17,14,17,15,17,15,17,15,16,16,16,16,16,16,16,17,16,17,15,18,15,18,15,18,15,19,15,19,14,20,14,20,14,21,14,21,14,22,13,22,13,23,13,23,13,24,13,25,13,25,12,26,12,26,12,27,12,27,12,28,12,29,11,29,11,30,11,31,11,31,11,32,11,33,11,33,10,34,10,35,10,35,10,36,10,37,10,37,10,38,10,39,9,40,9,40,9,41,9,42,9,43,9,43,9,44,9,45,9,46,9,47,8,47,8,48,8,49,8,50,8,51,8,51,8,52,8,53,8,54,8,55,8,55,8,56,8,57,8,58,8,59,7,60,7,61,7,61,7,62,7,63,7,64,7,65,7,66,7,67,7,67,7,68,7,69,7,70,7,71,7,72,7,73,7,74,7,74,7,75,7,76,7,77,7,78,7,79,7,80,7,81,7,81,7,82,7,83,7,84,7,85,7,86,7,87,7,87,7,88,7,89,7,90,7,91,7,92,7,93,7,93,7,94,7,95,7,96,7,97,7,98,7,99,7,99,7,100,7,101,7,102,7,103,7,103,7,104,7,105,7,106,8,107,8,107,8,108,8,109,8,110,8,110,8,111,8,112,8,113,8,114,8,114,8,115,8,116,8,117,8,117,9,118,9,119,9,120,9,121,9,121,9,122,9,123,9,124,9,125,10,125,10,126,10,127,10,128,10,129,10,130,11,131,11,131,11,132,11,133,11,134,11,135,12,136,12,137,12,137,12,138,12,139,13,140,13,141,13,142,13,143,13,143,14,144,14,145,14,146,14,147,14,148,15,149,15,150,15,150,15,151,15,152,16,153,16,154,16,155,16,156,17,157,17,157,17,158,17,159,18,160,18,161,18,162,18,163,19,163,19,164,19,165,19,166,20,167,20,168,20,169,20,169,20,170,21,171,21,172,21,173,21,173,22,174,22,175,22,176,22,177,23,177,23,178,23,179,23,180,24,181,24,181,24,182,24,183,25,184,25,184,25,185,25,186,25,187,26,187,26,188,26,189,26,189,27,190,27,191,27,191,27,192,27,193,28,193,28,194,28,195,28,195,28,196,29,197,29,197,29,198,29,198,29,199,29,199,30,200,30,201,30,201,30,202,30,202,30,203,31,203,31,204,31,204,31,205,31,205,31,206,31,206,31,206,32,207,32,207,32,208,32,208,32,
                               208,128,208,128,208,127,208,127,208,127,208,127,208,126,208,126,208,126,208,125,208,125,208,125,208,124,208,124,208,124,208,123,208,123,208,123,208,122,208,122,208,121,208,121,208,121,208,120,208,120,208,119,208,119,208,118,208,118,208,118,208,117,208,117,208,116,208,116,208,115,208,115,208,114,208,114,208,113,208,113,208,112,208,112,208,111,208,111,208,110,208,110,208,109,208,109,208,108,208,107,208,107,208,106,208,106,208,105,208,105,208,104,208,104,208,103,208,102,208,102,208,101,208,101,208,100,208,100,208,99,208,98,208,98,208,97,208,97,208,96,208,96,208,95,208,94,208,94,208,93,208,93,208,92,208,91,208,91,208,90,208,90,208,89,208,88,208,88,208,87,208,87,208,86,208,86,208,85,208,84,208,84,208,83,208,83,208,82,208,82,208,81,208,80,208,80,208,79,208,79,208,78,208,78,208,77,208,76,208,76,208,75,208,75,208,74,208,74,208,73,208,73,208,72,208,72,208,71,208,71,208,70,208,70,208,69,208,69,208,68,208,68,208,67,208,67,208,66,208,66,208,65,208,65,208,64,208,64,208,64,208,63,208,63,208,62,208,62,208,61,208,61,208,60,208,60,208,60,208,59,208,59,208,58,209,58,209,57,209,57,209,57,209,56,209,56,209,55,209,55,209,54,209,54,209,53,209,53,210,53,210,52,210,52,210,51,210,51,210,50,210,50,210,50,210,49,211,49,211,48,211,48,211,47,211,47,211,46,211,46,211,46,212,45,212,45,212,44,212,44,212,43,212,43,212,43,212,42,213,42,213,41,213,41,213,41,213,40,213,40,213,39,213,39,213,39,214,38,214,38,214,37,214,37,214,37,214,36,214,36,214,35,214,35,214,35,215,34,215,34,215,33,215,33,215,33,215,32,215,32,215,31,215,31,215,31,215,30,215,30,215,30,215,29,215,29,215,29,215,28,215,28,215,28,215,27,215,27,215,26,215,26,215,26,215,25,215,25,215,25,215,24,215,24,215,24,214,24,214,23,214,23,214,23,214,22,214,22,214,22,214,21,213,21,213,21,213,21,213,20,213,20,212,20,212,19,212,19,212,19,211,19,211,18,211,18,211,18,210,18,210,17,210,17,209,17,209,17,209,16,208,16,208,16,208,16,207,16,207,15,206,15,206,15,206,15,205,15,205,14,204,14,204,14,203,14,203,14,202,13,202,13,201,13,201,13,200,13,199,13,199,12,198,12,198,12,197,12,197,12,196,12,195,11,195,11,194,11,193,11,193,11,192,11,191,11,191,10,190,10,189,10,189,10,188,10,187,10,187,10,186,10,185,9,184,9,184,9,183,9,182,9,181,9,181,9,180,9,179,9,178,9,177,8,177,8,176,8,175,8,174,8,173,8,173,8,172,8,171,8,170,8,169,8,169,8,168,8,167,8,166,8,165,7,164,7,163,7,163,7,162,7,161,7,160,7,159,7,158,7,157,7,157,7,156,7,155,7,154,7,153,7,152,7,151,7,150,7,150,7,149,7,148,7,147,7,146,7,145,7,144,7,143,7,143,7,142,7,141,7,140,7,139,7,138,7,137,7,137,7,136,7,135,7,134,7,133,7,132,7,131,7,131,7,130,7,129,7,128,7,127,7,126,7,125,7,125,7,124,7,123,7,122,7,121,7,121,7,120,7,119,7,118,8,117,8,117,8,116,8,115,8,114,8,114,8,113,8,112,8,111,8,110,8,110,8,109,8,108,8,107,8,107,9,106,9,105,9,104,9,103,9,103,9,102,9,101,9,100,9,99,10,99,10,98,10,97,10,96,10,95,10,94,11,93,11,93,11,92,11,91,11,90,11,89,12,88,12,87,12,87,12,86,12,85,13,84,13,83,13,82,13,81,13,81,14,80,14,79,14,78,14,77,14,76,15,75,15,74,15,74,15,73,15,72,16,71,16,70,16,69,16,68,17,67,17,67,17,66,17,65,18,64,18,63,18,62,18,61,19,61,19,60,19,59,19,58,20,57,20,56,20,55,20,55,20,54,21,53,21,52,21,51,21,51,22,50,22,49,22,48,22,47,23,47,23,46,23,45,23,44,24,43,24,43,24,42,24,41,25,40,25,40,25,39,25,38,25,37,26,37,26,36,26,35,26,35,27,34,27,33,27,33,27,32,27,31,28,31,28,30,28,29,28,29,28,28,29,27,29,27,29,26,29,26,29,25,29,25,30,24,30,23,30,23,30,22,30,22,30,21,31,21,31,20,31,20,31,19,31,19,31,18,31,18,31,18,32,17,32,17,32,16,32,16,32,
                               16,0,16,0,17,0,17,0,17,0,17,0,18,0,18,0,18,0,19,0,19,0,20,0,20,0,20,0,21,0,21,0,22,0,22,0,22,0,23,0,23,0,24,0,24,0,25,0,25,0,26,0,26,0,27,0,28,0,28,0,29,0,29,0,30,0,30,0,31,0,31,0,32,0,33,0,33,0,34,0,34,0,35,0,36,0,36,0,37,0,38,0,38,0,39,0,40,0,40,0,41,0,41,0,42,0,43,0,43,0,44,0,45,0,45,0,46,0,47,0,47,0,48,0,49,0,49,0,50,0,51,0,51,0,52,0,53,0,53,0,54,0,55,0,55,0,56,0,56,0,57,0,58,0,58,0,59,0,60,0,60,0,61,0,61,0,62,0,63,0,63,0,64,0,64,0,65,0,66,0,66,0,67,0,67,0,68,0,68,0,69,0,69,0,70,0,70,0,71,0,71,0,72,0,72,0,73,0,73,0,73,0,74,0,74,0,75,0,75,0,75,0,76,0,76,0,76,0,77,0,77,0,77,0,78,0,78,0,78,0,79,0,79,0,79,0,79,0,79,0,80,0,80,0,80,0,80,0,80,0,80,0,80,0,80,1,80,1,80,1,81,1,81,1,81,1,81,1,80,2,80,2,80,2,80,2,80,2,80,2,80,3,80,3,80,3,80,3,80,3,79,4,79,4,79,4,79,4,79,4,78,5,78,5,78,5,78,5,78,6,77,6,77,6,77,6,76,6,76,7,76,7,76,7,75,7,75,8,75,8,74,8,74,8,74,9,73,9,73,9,73,9,72,10,72,10,71,10,71,10,71,11,70,11,70,11,70,12,69,12,69,12,68,12,68,13,68,13,67,13,67,13,66,14,66,14,66,14,65,15,65,15,64,15,64,15,64,16,63,16,63,16,62,17,62,17,62,17,61,17,61,18,60,18,60,18,60,19,59,19,59,19,58,19,58,20,58,20,57,20,57,21,56,21,56,21,56,22,55,22,55,22,55,22,54,23,54,23,54,23,53,24,53,24,53,24,53,24,52,25,52,25,52,25,51,26,51,26,51,26,51,26,50,27,50,27,50,27,50,28,50,28,49,28,49,28,49,29,49,29,49,29,49,29,49,30,48,30,48,30,48,30,48,31,48,31,48,31,48,31,48,32,48,32,48,32,48,33,48,33,48,33,48,33,48,34,48,34,48,34,48,34,49,35,49,35,49,35,49,35,49,36,49,36,49,36,50,36,50,37,50,37,50,37,50,37,51,38,51,38,51,38,51,38,51,39,52,39,52,39,52,39,52,40,53,40,53,40,53,40,54,41,54,41,54,41,54,41,55,42,55,42,55,42,56,42,56,43,56,43,57,43,57,43,57,44,58,44,58,44,58,44,59,45,59,45,60,45,60,45,60,46,61,46,61,46,61,46,62,47,62,47,63,47,63,47,63,48,64,48,64,48,64,48,65,49,65,49,65,49,66,49,66,50,67,50,67,50,67,50,68,51,68,51,68,51,69,51,69,52,70,52,70,52,70,52,71,53,71,53,71,53,72,53,72,54,72,54,73,54,73,54,73,55,74,55,74,55,74,55,74,56,75,56,75,56,75,56,76,57,76,57,76,57,76,57,77,58,77,58,77,58,77,58,77,59,78,59,78,59,78,59,78,60,78,60,79,60,79,60,79,61,79,61,79,61,79,61,79,62,80,62,80,62,80,62,80,63,80,63,80,63,80,63,80,64,80,64,80,64,80,64,80,65,80,65,80,65,80,65,80,66,80,66,80,66,80,66,79,67,79,67,79,67,79,67,79,68,79,68,79,68,78,68,78,69,78,69,78,69,78,69,77,70,77,70,77,70,77,70,77,71,76,71,76,71,76,71,76,72,75,72,75,72,75,72,74,73,74,73,74,73,74,73,73,74,73,74,73,74,72,74,72,75,72,75,71,75,71,75,71,76,70,76,70,76,70,76,69,77,69,77,68,77,68,77,68,78,67,78,67,78,67,78,66,79,66,79,65,79,65,79,65,80,64,80,64,80,64,80,63,81,63,81,63,81,62,81,62,82,61,82,61,82,61,82,60,83,60,83,60,83,59,83,59,84,58,84,58,84,58,84,57,85,57,85,57,85,56,85,56,86,56,86,55,86,55,86,55,87,54,87,54,87,54,87,54,88,53,88,53,88,53,88,52,89,52,89,52,89,52,89,51,90,51,90,51,90,51,90,51,91,50,91,50,91,50,91,50,92,50,92,49,92,49,92,49,93,49,93,49,93,49,93,49,94,48,94,48,94,48,94,48,95,48,95,48,95,48,95,48,96,48,96,48,96,48,96,48,97,48,97,48,97,48,97,48,98,48,98,48,98,48,98,49,99,49,99,49,99,49,99,49,100,49,100,49,100,50,100,50,101,50,101,50,101,50,101,51,102,51,102,51,102,51,102,51,103,52,103,52,103,52,103,52,104,53,104,53,104,53,104,54,105,54,105,54,105,54,105,55,106,55,106,55,106,56,106,56,107,56,107,57,107,57,107,57,108,58,108,58,108,58,108,59,109,59,109,60,109,60,109,60,110,61,110,61,110,61,110,62,111,62,111,63,111,63,111,63,112,64,112,64,112,64,112,65,113,65,113,65,113,66,113,66,114,67,114,67,114,67,114,68,115,68,115,68,115,69,115,69,116,70,116,70,116,70,116,71,117,71,117,71,117,72,117,72,118,72,118,73,118,73,118,73,119,74,119,74,119,74,119,74,120,75,120,75,120,75,120,76,121,76,121,76,121,76,121,77,122,77,122,77,122,77,122,77,123,78,123,78,123,78,123,78,124,78,124,79,124,79,124,79,125,79,125,79,125,79,125,79,126,80,126,80,126,80,126,80,127,80,127,80,127,80,127,80,128,80,128,80,128,80,128,80,129,80,129,80,129,80,129,80,130,80,130,80,130,80,130,80,131,80,131,79,131,79,131,79,132,79,132,79,132,79,132,79,133,79,133,79,133,78,134,78,134,78,134,78,134,78,135,78,135,77,135,77,136,77,136,77,136,77,136,77,137,76,137,76,137,76,138,76,138,75,138,75,138,75,139,75,139,74,139,74,140,74,140,74,140,73,141,73,141,73,141,73,141,72,142,72,142,72,142,72,143,71,143,71,143,71,143,70,144,70,144,70,144,70,145,69,145,69,145,69,145,68,146,68,146,68,146,67,147,67,147,67,147,66,147,66,148,66,148,65,148,65,148,65,149,64,149,64,149,64,150,63,150,63,150,63,150,62,151,62,151,62,151,61,151,61,152,61,152,60,152,60,152,60,153,59,153,59,153,59,153,58,154,58,154,58,154,58,154,57,154,57,155,57,155,56,155,56,155,56,156,55,156,55,156,55,156,54,156,54,157,54,157,53,157,53,157,53,157,52,158,52,158,52,158,52,158,51,158,51,158,51,159,50,159,50,159,50,159,50,159,49,159,49,159,49,160,49,160,48,160,48,160,48,160,47,160,47,160,47,160,47,161,46,161,46,161,46,161,46,161,45,161,45,161,45,161,45,161,44,161,44,161,44,162,44,162,43,162,43,162,43,162,42,162,42,162,42,162,42,162,41,162,41,162,41,162,40,162,40,162,40,162,40,162,39,162,39,162,39,162,38,162,38,162,38,162,38,162,37,162,37,162,37,162,36,162,36,162,36,162,35,162,35,162,35,162,35,162,34,162,34,162,34,162,33,162,33,162,33,162,33,162,32,162,32,162,32,162,31,162,31,162,31,162,31,162,30,162,30,162,30,162,29,162,29,162,29,162,29,162,28,162,28,162,28,162,28,162,27,162,27,162,27,162,26,162,26,161,26,161,26,161,25,161,25,161,25,161,25,161,24,161,24,161,24,161,24,161,23,161,23,161,23,161,23,161,22,161,22,161,22,161,22,161,22,161,21,161,21,161,21,161,21,161,20,161,20,160,20,160,20,160,20,160,19,160,19,160,19,160,19,160,19,160,18,160,18,160,18,160,18,160,18,160,18,160,17,160,17,160,17,160,17,160,17,160,17,160,17,160,16,160,16,160,16,160,16,160,
                               16,0,16,0,17,0,17,0,18,0,18,0,19,0,19,0,20,0,20,0,21,0,21,0,22,0,22,0,23,0,24,0,24,0,25,0,26,0,26,0,27,0,28,0,28,0,29,0,30,0,31,0,31,0,32,0,33,0,34,0,35,0,35,0,36,0,37,0,38,0,39,0,40,0,41,0,41,0,42,0,43,0,44,0,45,0,46,0,47,0,48,0,49,0,50,0,51,0,52,0,52,0,53,0,54,0,55,0,56,0,57,0,58,0,59,0,60,0,61,0,62,0,63,0,64,0,65,0,66,0,67,0,68,0,69,0,70,0,71,0,72,0,73,0,74,0,75,0,76,0,77,0,77,0,78,0,79,0,80,0,81,0,82,0,83,0,84,0,85,0,86,0,87,0,87,0,88,0,89,0,90,0,91,0,92,0,92,0,93,0,94,0,95,0,96,0,96,0,97,0,98,0,98,0,99,0,100,0,101,0,101,0,102,0,103,0,103,0,104,0,104,0,105,0,105,0,106,0,107,0,107,0,108,0,108,0,108,0,109,0,109,0,110,0,110,0,110,0,111,0,111,0,111,0,112,0,112,0,112,0,112,0,113,0,113,1,113,1,113,1,113,1,113,1,113,1,114,1,114,2,114,2,114,2,114,2,114,2,114,2,114,3,114,3,114,3,113,3,113,3,113,4,113,4,113,4,113,4,113,4,113,5,112,5,112,5,112,5,112,6,112,6,111,6,111,6,111,6,110,7,110,7,110,7,110,7,109,8,109,8,109,8,108,8,108,9,108,9,107,9,107,9,107,10,106,10,106,10,105,10,105,11,105,11,104,11,104,12,103,12,103,12,103,12,102,13,102,13,101,13,101,13,100,14,100,14,100,14,99,15,99,15,98,15,98,15,97,16,97,16,96,16,96,17,96,17,95,17,95,17,94,18,94,18,93,18,93,19,93,19,92,19,92,19,91,20,91,20,90,20,90,21,90,21,89,21,89,22,88,22,88,22,88,22,87,23,87,23,87,23,86,24,86,24,85,24,85,24,85,25,84,25,84,25,84,26,84,26,83,26,83,26,83,27,83,27,82,27,82,28,82,28,82,28,81,28,81,29,81,29,81,29,81,29,81,30,80,30,80,30,80,30,80,31,80,31,80,31,80,31,80,32,80,32,80,32,80,33,80,33,80,33,80,33,80,34,80,34,80,34,80,34,81,35,81,35,81,35,81,35,81,36,81,36,81,36,82,36,82,37,82,37,82,37,82,37,83,38,83,38,83,38,83,38,83,39,84,39,84,39,84,39,84,40,85,40,85,40,85,40,86,41,86,41,86,41,86,41,87,42,87,42,87,42,88,42,88,43,88,43,89,43,89,43,89,44,90,44,90,44,90,44,91,45,91,45,92,45,92,45,92,46,93,46,93,46,93,46,94,47,94,47,95,47,95,47,95,48,96,48,96,48,96,48,97,49,97,49,97,49,98,49,98,50,99,50,99,50,99,50,100,51,100,51,100,51,101,51,101,52,102,52,102,52,102,52,103,53,103,53,103,53,104,53,104,54,104,54,105,54,105,54,105,55,106,55,106,55,106,55,106,56,107,56,107,56,107,56,108,57,108,57,108,57,108,57,109,58,109,58,109,58,109,58,109,59,110,59,110,59,110,59,110,60,110,60,111,60,111,60,111,61,111,61,111,61,111,61,111,62,112,62,112,62,112,62,112,63,112,63,112,63,112,63,112,64,112,64,112,64,112,64,112,65,112,65,112,65,112,65,112,66,112,66,112,66,112,66,111,67,111,67,111,67,111,67,111,68,111,68,111,68,110,68,110,69,110,69,110,69,110,69,109,70,109,70,109,70,109,70,109,71,108,71,108,71,108,71,108,72,107,72,107,72,107,72,106,73,106,73,106,73,106,73,105,74,105,74,105,74,104,74,104,75,104,75,103,75,103,75,103,76,102,76,102,76,102,76,101,77,101,77,100,77,100,77,100,78,99,78,99,78,99,78,98,79,98,79,97,79,97,79,97,80,96,80,96,80,96,80,95,81,95,81,95,81,94,81,94,82,93,82,93,82,93,82,92,83,92,83,92,83,91,83,91,84,90,84,90,84,90,84,89,85,89,85,89,85,88,85,88,86,88,86,87,86,87,86,87,87,86,87,86,87,86,87,86,88,85,88,85,88,85,88,84,89,84,89,84,89,84,89,83,90,83,90,83,90,83,90,83,91,82,91,82,91,82,91,82,92,82,92,81,92,81,92,81,93,81,93,81,93,81,93,81,94,80,94,80,94,80,94,80,95,80,95,80,95,80,95,80,96,80,96,80,96,80,96,80,97,80,97,80,97,80,97,80,98,80,98,80,98,80,98,81,99,81,99,81,99,81,99,81,100,81,100,81,100,82,100,82,101,82,101,82,101,82,101,83,102,83,102,83,102,83,102,83,103,84,103,84,103,84,103,84,104,85,104,85,104,85,104,86,105,86,105,86,105,86,105,87,106,87,106,87,106,88,106,88,107,88,107,89,107,89,107,89,108,90,108,90,108,90,108,91,109,91,109,92,109,92,109,92,110,93,110,93,110,93,110,94,111,94,111,95,111,95,111,95,112,96,112,96,112,96,112,97,113,97,113,97,113,98,113,98,114,99,114,99,114,99,114,100,115,100,115,100,115,101,115,101,116,102,116,102,116,102,116,103,117,103,117,103,117,104,117,104,118,104,118,105,118,105,118,105,119,106,119,106,119,106,119,106,120,107,120,107,120,107,120,108,121,108,121,108,121,108,121,109,122,109,122,109,122,109,122,109,123,110,123,110,123,110,123,110,124,110,124,111,124,111,124,111,125,111,125,111,125,111,125,111,126,112,126,112,126,112,126,112,127,112,127,112,127,112,127,112,128,112,128,112,128,112,128,112,129,112,129,112,129,112,129,112,130,112,130,112,130,112,130,112,131,112,131,112,131,112,131,111,132,111,132,111,132,111,132,111,133,111,133,111,133,111,134,111,134,111,134,110,134,110,135,110,135,110,135,110,136,110,136,110,136,109,136,109,137,109,137,109,137,109,138,109,138,108,138,108,138,108,139,108,139,108,139,107,140,107,140,107,140,107,141,107,141,106,141,106,141,106,142,106,142,105,142,105,143,105,143,105,143,104,143,104,144,104,144,104,144,103,145,103,145,103,145,103,145,102,146,102,146,102,146,101,147,101,147,101,147,101,147,100,148,100,148,100,148,99,148,99,149,99,149,98,149,98,150,98,150,97,150,97,150,97,151,97,151,96,151,96,151,96,152,95,152,95,152,95,152,94,153,94,153,93,153,93,153,93,154,92,154,92,154,92,154,91,154,91,155,91,155,90,155,90,155,90,156,89,156,89,156,89,156,88,156,88,157,87,157,87,157,87,157,86,157,86,158,86,158,85,158,85,158,84,158,84,158,84,159,83,159,83,159,83,159,82,159,82,159,81,159,81,160,81,160,80,160,80,160,80,160,79,160,79,160,78,160,78,161,78,161,77,161,77,161,76,161,76,161,75,161,75,161,75,161,74,161,74,161,73,162,73,162,72,162,72,162,71,162,71,162,70,162,70,162,69,162,69,162,68,162,67,162,67,162,66,162,66,162,65,162,65,162,64,162,64,162,63,162,63,162,62,162,61,162,61,162,60,162,60,162,59,162,58,162,58,162,57,162,57,162,56,162,56,162,55,162,54,162,54,162,53,162,53,162,52,162,51,162,51,162,50,162,50,162,49,162,48,162,48,162,47,162,47,162,46,162,45,162,45,162,44,162,44,162,43,162,42,162,42,162,41,162,41,162,40,162,40,162,39,162,38,162,38,161,37,161,37,161,36,161,36,161,35,161,35,161,34,161,33,161,33,161,32,161,32,161,31,161,31,161,30,161,30,161,29,161,29,161,28,161,28,161,27,161,27,161,26,161,26,161,25,161,25,160,24,160,24,160,24,160,23,160,23,160,22,160,22,160,22,160,21,160,21,160,20,160,20,160,20,160,19,160,19,160,19,160,18,160,18,160,18,160,17,160,17,160,17,160,17,160,16,160,16,160,
                               208,0,208,0,207,0,207,0,206,0,206,0,205,0,205,0,204,0,204,0,203,0,203,0,202,0,202,0,201,0,200,0,200,0,199,0,198,0,198,0,197,0,196,0,196,0,195,0,194,0,193,0,193,0,192,0,191,0,190,0,189,0,189,0,188,0,187,0,186,0,185,0,184,0,183,0,183,0,182,0,181,0,180,0,179,0,178,0,177,0,176,0,175,0,174,0,173,0,172,0,172,0,171,0,170,0,169,0,168,0,167,0,166,0,165,0,164,0,163,0,162,0,161,0,160,0,159,0,158,0,157,0,156,0,155,0,154,0,153,0,152,0,151,0,150,0,149,0,148,0,147,0,147,0,146,0,145,0,144,0,143,0,142,0,141,0,140,0,139,0,138,0,137,0,137,0,136,0,135,0,134,0,133,0,132,0,132,0,131,0,130,0,129,0,128,0,128,0,127,0,126,0,126,0,125,0,124,0,123,0,123,0,122,0,121,0,121,0,120,0,120,0,119,0,119,0,118,0,117,0,117,0,116,0,116,0,116,0,115,0,115,0,114,0,114,0,114,0,113,0,113,0,113,0,112,0,112,0,112,0,112,0,111,0,111,1,111,1,111,1,111,1,111,1,111,1,110,1,110,2,110,2,110,2,110,2,110,2,110,2,110,3,110,3,110,3,111,3,111,3,111,4,111,4,111,4,111,4,111,4,111,5,112,5,112,5,112,5,112,6,113,6,113,6,113,6,113,6,114,7,114,7,114,7,114,7,115,8,115,8,115,8,116,8,116,9,116,9,117,9,117,9,117,10,118,10,118,10,119,10,119,11,119,11,120,11,120,12,121,12,121,12,121,12,122,13,122,13,123,13,123,13,124,14,124,14,124,14,125,15,125,15,126,15,126,15,127,16,127,16,128,16,128,17,128,17,129,17,129,17,130,18,130,18,131,18,131,19,131,19,132,19,132,19,133,20,133,20,134,20,134,21,134,21,135,21,135,22,136,22,136,22,136,22,137,23,137,23,138,23,138,24,138,24,139,24,139,24,139,25,140,25,140,25,140,26,140,26,141,26,141,26,141,27,141,27,142,27,142,28,142,28,142,28,143,28,143,29,143,29,143,29,143,29,143,30,144,30,144,30,144,30,144,31,144,31,144,31,144,31,144,32,144,32,144,32,144,33,144,33,144,33,144,33,144,34,144,34,144,34,144,34,143,35,143,35,143,35,143,35,143,36,143,36,143,36,142,36,142,37,142,37,142,37,142,37,141,38,141,38,141,38,141,38,141,39,140,39,140,39,140,39,140,40,139,40,139,40,139,40,138,41,138,41,138,41,138,41,137,42,137,42,137,42,136,42,136,43,136,43,135,43,135,43,135,44,134,44,134,44,134,44,133,45,133,45,132,45,132,45,132,46,131,46,131,46,131,46,130,47,130,47,129,47,129,47,129,48,128,48,128,48,128,48,127,49,127,49,127,49,126,49,126,50,125,50,125,50,125,50,124,51,124,51,124,51,123,51,123,52,122,52,122,52,122,52,121,53,121,53,121,53,120,53,120,54,120,54,119,54,119,54,119,55,118,55,118,55,118,55,118,56,117,56,117,56,117,56,116,57,116,57,116,57,116,57,115,58,115,58,115,58,115,58,115,59,114,59,114,59,114,59,114,60,114,60,113,60,113,60,113,61,113,61,113,61,113,61,113,62,112,62,112,62,112,62,112,63,112,63,112,63,112,63,112,64,112,64,112,64,112,64,112,65,112,65,112,65,112,65,112,66,112,66,112,66,112,66,113,67,113,67,113,67,113,67,113,68,113,68,113,68,114,68,114,69,114,69,114,69,114,69,115,70,115,70,115,70,115,70,115,71,116,71,116,71,116,71,116,72,117,72,117,72,117,72,118,73,118,73,118,73,118,73,119,74,119,74,119,74,120,74,120,75,120,75,121,75,121,75,121,76,122,76,122,76,122,76,123,77,123,77,124,77,124,77,124,78,125,78,125,78,125,78,126,79,126,79,127,79,127,79,127,80,128,80,128,80,128,80,129,81,129,81,129,81,130,81,130,82,131,82,131,82,131,82,132,83,132,83,132,83,133,83,133,84,134,84,134,84,134,84,135,85,135,85,135,85,136,85,136,86,136,86,137,86,137,86,137,87,138,87,138,87,138,87,138,88,139,88,139,88,139,88,140,89,140,89,140,89,140,89,141,90,141,90,141,90,141,90,141,91,142,91,142,91,142,91,142,92,142,92,143,92,143,92,143,93,143,93,143,93,143,93,143,94,144,94,144,94,144,94,144,95,144,95,144,95,144,95,144,96,144,96,144,96,144,96,144,97,144,97,144,97,144,97,144,98,144,98,144,98,144,98,143,99,143,99,143,99,143,99,143,100,143,100,143,100,142,100,142,101,142,101,142,101,142,101,141,102,141,102,141,102,141,102,141,103,140,103,140,103,140,103,140,104,139,104,139,104,139,104,138,105,138,105,138,105,138,105,137,106,137,106,137,106,136,106,136,107,136,107,135,107,135,107,135,108,134,108,134,108,134,108,133,109,133,109,132,109,132,109,132,110,131,110,131,110,131,110,130,111,130,111,129,111,129,111,129,112,128,112,128,112,128,112,127,113,127,113,127,113,126,113,126,114,125,114,125,114,125,114,124,115,124,115,124,115,123,115,123,116,122,116,122,116,122,116,121,117,121,117,121,117,120,117,120,118,120,118,119,118,119,118,119,119,118,119,118,119,118,119,118,120,117,120,117,120,117,120,116,121,116,121,116,121,116,121,115,122,115,122,115,122,115,122,115,123,114,123,114,123,114,123,114,124,114,124,113,124,113,124,113,125,113,125,113,125,113,125,113,126,112,126,112,126,112,126,112,127,112,127,112,127,112,127,112,128,112,128,112,128,112,128,112,129,112,129,112,129,112,129,112,130,112,130,112,130,112,130,112,131,112,131,112,131,112,131,113,132,113,132,113,132,113,132,113,133,113,133,113,133,113,134,113,134,113,134,114,134,114,135,114,135,114,135,114,136,114,136,114,136,115,136,115,137,115,137,115,137,115,138,115,138,116,138,116,138,116,139,116,139,116,139,117,140,117,140,117,140,117,141,117,141,118,141,118,141,118,142,118,142,119,142,119,143,119,143,119,143,120,143,120,144,120,144,120,144,121,145,121,145,121,145,121,145,122,146,122,146,122,146,123,147,123,147,123,147,123,147,124,148,124,148,124,148,125,148,125,149,125,149,126,149,126,150,126,150,127,150,127,150,127,151,127,151,128,151,128,151,128,152,129,152,129,152,129,152,130,153,130,153,131,153,131,153,131,154,132,154,132,154,132,154,133,154,133,155,133,155,134,155,134,155,134,156,135,156,135,156,135,156,136,156,136,157,137,157,137,157,137,157,138,157,138,158,138,158,139,158,139,158,140,158,140,158,140,159,141,159,141,159,141,159,142,159,142,159,143,159,143,160,143,160,144,160,144,160,144,160,145,160,145,160,146,160,146,161,146,161,147,161,147,161,148,161,148,161,149,161,149,161,149,161,150,161,150,161,151,162,151,162,152,162,152,162,153,162,153,162,154,162,154,162,155,162,155,162,156,162,157,162,157,162,158,162,158,162,159,162,159,162,160,162,160,162,161,162,161,162,162,162,163,162,163,162,164,162,164,162,165,162,166,162,166,162,167,162,167,162,168,162,168,162,169,162,170,162,170,162,171,162,171,162,172,162,173,162,173,162,174,162,174,162,175,162,176,162,176,162,177,162,177,162,178,162,179,162,179,162,180,162,180,162,181,162,182,162,182,162,183,162,183,162,184,162,184,162,185,162,186,162,186,161,187,161,187,161,188,161,188,161,189,161,189,161,190,161,191,161,191,161,192,161,192,161,193,161,193,161,194,161,194,161,195,161,195,161,196,161,196,161,197,161,197,161,198,161,198,161,199,161,199,160,200,160,200,160,200,160,201,160,201,160,202,160,202,160,202,160,203,160,203,160,204,160,204,160,204,160,205,160,205,160,205,160,206,160,206,160,206,160,207,160,207,160,207,160,207,160,208,160,208,160,
                               208,0,208,0,207,0,207,0,207,0,207,0,206,0,206,0,206,0,205,0,205,0,204,0,204,0,204,0,203,0,203,0,202,0,202,0,202,0,201,0,201,0,200,0,200,0,199,0,199,0,198,0,198,0,197,0,196,0,196,0,195,0,195,0,194,0,194,0,193,0,193,0,192,0,191,0,191,0,190,0,190,0,189,0,188,0,188,0,187,0,186,0,186,0,185,0,184,0,184,0,183,0,183,0,182,0,181,0,181,0,180,0,179,0,179,0,178,0,177,0,177,0,176,0,175,0,175,0,174,0,173,0,173,0,172,0,171,0,171,0,170,0,169,0,169,0,168,0,168,0,167,0,166,0,166,0,165,0,164,0,164,0,163,0,163,0,162,0,161,0,161,0,160,0,160,0,159,0,158,0,158,0,157,0,157,0,156,0,156,0,155,0,155,0,154,0,154,0,153,0,153,0,152,0,152,0,151,0,151,0,151,0,150,0,150,0,149,0,149,0,149,0,148,0,148,0,148,0,147,0,147,0,147,0,146,0,146,0,146,0,145,0,145,0,145,0,145,0,145,0,144,0,144,0,144,0,144,0,144,0,144,0,144,0,144,1,144,1,144,1,143,1,143,1,143,1,143,1,144,2,144,2,144,2,144,2,144,2,144,2,144,3,144,3,144,3,144,3,144,3,145,4,145,4,145,4,145,4,145,4,146,5,146,5,146,5,146,5,146,6,147,6,147,6,147,6,148,6,148,7,148,7,148,7,149,7,149,8,149,8,150,8,150,8,150,9,151,9,151,9,151,9,152,10,152,10,153,10,153,10,153,11,154,11,154,11,154,12,155,12,155,12,156,12,156,13,156,13,157,13,157,13,158,14,158,14,158,14,159,15,159,15,160,15,160,15,160,16,161,16,161,16,162,17,162,17,162,17,163,17,163,18,164,18,164,18,164,19,165,19,165,19,166,19,166,20,166,20,167,20,167,21,168,21,168,21,168,22,169,22,169,22,169,22,170,23,170,23,170,23,171,24,171,24,171,24,171,24,172,25,172,25,172,25,173,26,173,26,173,26,173,26,174,27,174,27,174,27,174,28,174,28,175,28,175,28,175,29,175,29,175,29,175,29,175,30,176,30,176,30,176,30,176,31,176,31,176,31,176,31,176,32,176,32,176,32,176,33,176,33,176,33,176,33,176,34,176,34,176,34,176,34,175,35,175,35,175,35,175,35,175,36,175,36,175,36,174,36,174,37,174,37,174,37,174,37,173,38,173,38,173,38,173,38,173,39,172,39,172,39,172,39,172,40,171,40,171,40,171,40,170,41,170,41,170,41,170,41,169,42,169,42,169,42,168,42,168,43,168,43,167,43,167,43,167,44,166,44,166,44,166,44,165,45,165,45,164,45,164,45,164,46,163,46,163,46,163,46,162,47,162,47,161,47,161,47,161,48,160,48,160,48,160,48,159,49,159,49,159,49,158,49,158,50,157,50,157,50,157,50,156,51,156,51,156,51,155,51,155,52,154,52,154,52,154,52,153,53,153,53,153,53,152,53,152,54,152,54,151,54,151,54,151,55,150,55,150,55,150,55,150,56,149,56,149,56,149,56,148,57,148,57,148,57,148,57,147,58,147,58,147,58,147,58,147,59,146,59,146,59,146,59,146,60,146,60,145,60,145,60,145,61,145,61,145,61,145,61,145,62,144,62,144,62,144,62,144,63,144,63,144,63,144,63,144,64,144,64,144,64,144,64,144,65,144,65,144,65,144,65,144,66,144,66,144,66,144,66,145,67,145,67,145,67,145,67,145,68,145,68,145,68,146,68,146,69,146,69,146,69,146,69,147,70,147,70,147,70,147,70,147,71,148,71,148,71,148,71,148,72,149,72,149,72,149,72,150,73,150,73,150,73,150,73,151,74,151,74,151,74,152,74,152,75,152,75,153,75,153,75,153,76,154,76,154,76,154,76,155,77,155,77,156,77,156,77,156,78,157,78,157,78,157,78,158,79,158,79,159,79,159,79,159,80,160,80,160,80,160,80,161,81,161,81,161,81,162,81,162,82,163,82,163,82,163,82,164,83,164,83,164,83,165,83,165,84,166,84,166,84,166,84,167,85,167,85,167,85,168,85,168,86,168,86,169,86,169,86,169,87,170,87,170,87,170,87,170,88,171,88,171,88,171,88,172,89,172,89,172,89,172,89,173,90,173,90,173,90,173,90,173,91,174,91,174,91,174,91,174,92,174,92,175,92,175,92,175,93,175,93,175,93,175,93,175,94,176,94,176,94,176,94,176,95,176,95,176,95,176,95,176,96,176,96,176,96,176,96,176,97,176,97,176,97,176,97,176,98,176,98,176,98,176,98,175,99,175,99,175,99,175,99,175,100,175,100,175,100,174,100,174,101,174,101,174,101,174,101,173,102,173,102,173,102,173,102,173,103,172,103,172,103,172,103,172,104,171,104,171,104,171,104,170,105,170,105,170,105,170,105,169,106,169,106,169,106,168,106,168,107,168,107,167,107,167,107,167,108,166,108,166,108,166,108,165,109,165,109,164,109,164,109,164,110,163,110,163,110,163,110,162,111,162,111,161,111,161,111,161,112,160,112,160,112,160,112,159,113,159,113,159,113,158,113,158,114,157,114,157,114,157,114,156,115,156,115,156,115,155,115,155,116,154,116,154,116,154,116,153,117,153,117,153,117,152,117,152,118,152,118,151,118,151,118,151,119,150,119,150,119,150,119,150,120,149,120,149,120,149,120,148,121,148,121,148,121,148,121,147,122,147,122,147,122,147,122,147,123,146,123,146,123,146,123,146,124,146,124,145,124,145,124,145,125,145,125,145,125,145,125,145,126,144,126,144,126,144,126,144,127,144,127,144,127,144,127,144,128,144,128,144,128,144,128,144,129,144,129,144,129,144,129,144,130,144,130,144,130,144,130,144,131,144,131,145,131,145,131,145,132,145,132,145,132,145,132,145,133,145,133,145,133,146,134,146,134,146,134,146,134,146,135,146,135,147,135,147,136,147,136,147,136,147,136,148,137,148,137,148,137,148,138,148,138,149,138,149,138,149,139,149,139,150,139,150,140,150,140,150,140,151,141,151,141,151,141,151,141,152,142,152,142,152,142,152,143,153,143,153,143,153,143,154,144,154,144,154,144,154,145,155,145,155,145,155,145,156,146,156,146,156,146,157,147,157,147,157,147,158,147,158,148,158,148,159,148,159,148,159,149,160,149,160,149,160,150,161,150,161,150,161,150,162,151,162,151,162,151,163,151,163,152,163,152,164,152,164,152,164,153,165,153,165,153,165,153,166,154,166,154,166,154,167,154,167,154,167,155,167,155,168,155,168,155,168,156,169,156,169,156,169,156,170,156,170,157,170,157,171,157,171,157,171,157,172,158,172,158,172,158,172,158,173,158,173,158,173,159,174,159,174,159,174,159,174,159,175,159,175,159,175,160,175,160,176,160,176,160,176,160,177,160,177,160,177,160,177,161,178,161,178,161,178,161,178,161,179,161,179,161,179,161,179,161,180,161,180,161,180,162,180,162,181,162,181,162,181,162,182,162,182,162,182,162,182,162,183,162,183,162,183,162,184,162,184,162,184,162,184,162,185,162,185,162,185,162,186,162,186,162,186,162,186,162,187,162,187,162,187,162,188,162,188,162,188,162,189,162,189,162,189,162,189,162,190,162,190,162,190,162,191,162,191,162,191,162,191,162,192,162,192,162,192,162,193,162,193,162,193,162,193,162,194,162,194,162,194,162,195,162,195,162,195,162,195,162,196,162,196,162,196,162,196,162,197,162,197,162,197,162,198,162,198,161,198,161,198,161,199,161,199,161,199,161,199,161,200,161,200,161,200,161,200,161,201,161,201,161,201,161,201,161,202,161,202,161,202,161,202,161,202,161,203,161,203,161,203,161,203,161,204,161,204,160,204,160,204,160,204,160,205,160,205,160,205,160,205,160,205,160,206,160,206,160,206,160,206,160,206,160,206,160,207,160,207,160,207,160,207,160,207,160,207,160,207,160,208,160,208,160,208,160,208,160,
                               16,0,16,0,17,0,17,0,18,0,18,0,19,0,20,0,20,0,21,0,21,0,22,0,23,0,23,0,24,0,25,0,25,0,26,0,27,0,28,0,28,0,29,0,30,0,31,0,31,0,32,0,33,0,34,0,35,0,36,0,36,0,37,0,38,0,39,0,40,0,41,0,42,0,43,0,44,0,45,0,45,0,46,0,47,0,48,0,49,0,50,0,51,0,52,0,53,0,54,0,55,0,56,0,57,0,58,0,59,0,60,0,61,0,62,0,63,0,64,0,65,0,66,0,67,0,68,0,69,0,70,0,71,0,72,0,73,0,74,0,75,0,76,0,76,0,77,0,78,0,79,0,80,0,81,0,82,0,83,0,84,0,85,0,86,0,87,0,87,0,88,0,89,0,90,0,91,0,92,0,92,0,93,0,94,0,95,0,96,0,96,0,97,0,98,0,98,0,99,0,100,0,100,0,101,0,102,0,102,0,103,0,104,0,104,0,105,0,105,0,106,0,106,0,107,0,107,0,108,0,108,0,109,0,109,0,109,0,110,0,110,0,110,0,111,0,111,0,111,0,111,0,112,0,112,0,112,0,112,0,112,0,112,0,112,1,112,1,112,1,112,1,112,1,112,1,112,2,112,2,112,2,112,2,112,2,111,3,111,3,111,3,111,3,110,3,110,3,110,4,109,4,109,4,108,4,108,4,108,5,107,5,107,5,106,5,106,5,105,6,105,6,104,6,104,6,103,7,102,7,102,7,101,7,101,7,100,8,99,8,99,8,98,8,97,9,97,9,96,9,95,9,95,10,94,10,93,10,92,10,92,11,91,11,90,11,89,11,89,12,88,12,87,12,86,12,86,13,85,13,84,13,83,13,82,14,82,14,81,14,80,14,79,15,78,15,78,15,77,15,76,16,75,16,75,16,74,17,73,17,72,17,71,17,71,18,70,18,69,18,68,18,68,19,67,19,66,19,66,20,65,20,64,20,63,20,63,21,62,21,61,21,61,22,60,22,60,22,59,23,58,23,58,23,57,23,57,24,56,24,55,24,55,25,54,25,54,25,53,25,53,26,53,26,52,26,52,27,51,27,51,27,51,28,50,28,50,28,50,28,49,29,49,29,49,29,49,30,49,30,48,30,48,31,48,31,48,31,48,31,48,32,48,32,48,32,48,33,48,33,48,33,48,33,48,34,48,34,48,34,49,35,49,35,49,35,49,35,49,36,49,36,49,36,50,37,50,37,50,37,50,37,51,38,51,38,51,38,51,38,52,39,52,39,52,39,53,39,53,40,53,40,54,40,54,40,54,41,55,41,55,41,56,41,56,42,56,42,57,42,57,42,58,43,58,43,59,43,59,43,60,43,60,44,61,44,61,44,62,44,62,45,63,45,63,45,64,45,64,46,65,46,65,46,66,46,66,46,67,47,67,47,68,47,69,47,69,48,70,48,70,48,71,48,72,48,72,49,73,49,73,49,74,49,75,50,75,50,76,50,77,50,77,50,78,51,79,51,79,51,80,51,81,52,81,52,82,52,82,52,83,53,84,53,84,53,85,53,86,53,86,54,87,54,88,54,89,54,89,55,90,55,91,55,91,55,92,56,93,56,93,56,94,56,95,57,95,57,96,57,97,57,97,58,98,58,99,58,99,58,100,59,101,59,101,59,102,59,103,60,103,60,104,60,105,61,105,61,106,61,106,61,107,62,108,62,108,62,109,63,110,63,110,63,111,63,111,64,112,64,113,64,113,65,114,65,114,65,115,65,116,66,116,66,117,66,118,67,118,67,119,67,119,67,120,68,121,68,121,68,122,69,123,69,123,69,124,69,125,70,125,70,126,70,127,70,127,71,128,71,129,71,129,71,130,72,131,72,131,72,132,72,133,73,133,73,134,73,135,73,135,74,136,74,137,74,138,74,138,75,139,75,140,75,140,75,141,75,142,76,142,76,143,76,144,76,144,77,145,77,145,77,146,77,147,78,147,78,148,78,149,78,149,78,150,79,151,79,151,79,152,79,152,80,153,80,154,80,154,80,155,80,155,81,156,81,157,81,157,81,158,82,158,82,159,82,159,82,160,82,160,83,161,83,161,83,162,83,163,84,163,84,163,84,164,84,164,85,165,85,165,85,166,85,166,85,167,86,167,86,168,86,168,86,168,87,169,87,169,87,170,87,170,88,170,88,171,88,171,88,171,89,172,89,172,89,172,89,173,90,173,90,173,90,173,90,174,91,174,91,174,91,174,91,175,92,175,92,175,92,175,93,175,93,175,93,175,93,176,94,176,94,176,94,176,95,176,95,176,95,176,95,176,96,176,96,176,96,176,97,176,97,176,97,176,97,176,98,175,98,175,98,175,99,175,99,175,99,174,100,174,100,174,100,173,100,173,101,173,101,172,101,172,102,171,102,171,102,171,103,170,103,170,103,169,103,169,104,168,104,167,104,167,105,166,105,166,105,165,106,164,106,164,106,163,106,163,107,162,107,161,107,161,108,160,108,159,108,158,108,158,109,157,109,156,109,156,110,155,110,154,110,153,110,153,111,152,111,151,111,150,111,149,112,149,112,148,112,147,113,146,113,146,113,145,113,144,114,143,114,142,114,142,114,141,115,140,115,139,115,138,115,138,116,137,116,136,116,135,116,135,117,134,117,133,117,132,117,132,118,131,118,130,118,129,118,129,119,128,119,127,119,127,119,126,120,125,120,125,120,124,120,123,121,123,121,122,121,122,121,121,121,120,122,120,122,119,122,119,122,118,123,118,123,117,123,117,123,116,123,116,124,116,124,115,124,115,124,114,124,114,125,114,125,113,125,113,125,113,125,113,125,112,126,112,126,112,126,112,126,112,126,112,127,112,127,112,127,112,127,112,127,112,127,112,128,112,128,112,128,112,128,112,128,112,128,113,128,113,129,113,129,113,129,114,129,114,129,114,129,115,129,115,129,115,129,116,130,116,130,117,130,117,130,118,130,118,130,119,130,119,130,120,130,120,130,121,130,122,130,122,130,123,130,124,131,124,131,125,131,126,131,126,131,127,131,128,131,128,131,129,131,130,131,131,131,132,131,132,131,133,131,134,131,135,131,136,131,137,131,137,131,138,131,139,131,140,131,141,131,142,131,143,131,144,131,145,131,146,131,147,131,148,131,148,131,149,131,150,131,151,131,152,131,153,130,154,130,155,130,156,130,157,130,158,130,159,130,160,130,161,130,162,130,163,130,164,130,165,130,166,130,167,130,168,130,169,130,170,130,171,130,172,130,173,130,174,130,175,129,176,129,177,129,178,129,179,129,179,129,180,129,181,129,182,129,183,129,184,129,185,129,186,129,187,129,188,129,188,129,189,129,190,129,191,129,192,129,193,129,193,129,194,128,195,128,196,128,196,128,197,128,198,128,199,128,199,128,200,128,201,128,201,128,202,128,203,128,203,128,204,128,204,128,205,128,206,128,206,128,207,128,207,128,208,128,208,128,
                               208,0,208,0,207,0,207,0,206,0,206,0,205,0,204,0,204,0,203,0,203,0,202,0,201,0,201,0,200,0,199,0,199,0,198,0,197,0,196,0,196,0,195,0,194,0,193,0,193,0,192,0,191,0,190,0,189,0,188,0,188,0,187,0,186,0,185,0,184,0,183,0,182,0,181,0,180,0,179,0,179,0,178,0,177,0,176,0,175,0,174,0,173,0,172,0,171,0,170,0,169,0,168,0,167,0,166,0,165,0,164,0,163,0,162,0,161,0,160,0,159,0,158,0,157,0,156,0,155,0,154,0,153,0,152,0,151,0,150,0,149,0,148,0,148,0,147,0,146,0,145,0,144,0,143,0,142,0,141,0,140,0,139,0,138,0,137,0,137,0,136,0,135,0,134,0,133,0,132,0,132,0,131,0,130,0,129,0,128,0,128,0,127,0,126,0,126,0,125,0,124,0,124,0,123,0,122,0,122,0,121,0,120,0,120,0,119,0,119,0,118,0,118,0,117,0,117,0,116,0,116,0,115,0,115,0,115,0,114,0,114,0,114,0,113,0,113,0,113,0,113,0,112,0,112,0,112,0,112,0,112,0,112,0,112,1,112,1,112,1,112,1,112,1,112,1,112,2,112,2,112,2,112,2,112,2,113,3,113,3,113,3,113,3,114,3,114,3,114,4,115,4,115,4,116,4,116,4,116,5,117,5,117,5,118,5,118,5,119,6,119,6,120,6,120,6,121,7,122,7,122,7,123,7,123,7,124,8,125,8,125,8,126,8,127,9,127,9,128,9,129,9,129,10,130,10,131,10,132,10,132,11,133,11,134,11,135,11,135,12,136,12,137,12,138,12,138,13,139,13,140,13,141,13,142,14,142,14,143,14,144,14,145,15,146,15,146,15,147,15,148,16,149,16,149,16,150,17,151,17,152,17,153,17,153,18,154,18,155,18,156,18,156,19,157,19,158,19,158,20,159,20,160,20,161,20,161,21,162,21,163,21,163,22,164,22,164,22,165,23,166,23,166,23,167,23,167,24,168,24,169,24,169,25,170,25,170,25,171,25,171,26,171,26,172,26,172,27,173,27,173,27,173,28,174,28,174,28,174,28,175,29,175,29,175,29,175,30,175,30,176,30,176,31,176,31,176,31,176,31,176,32,176,32,176,32,176,33,176,33,176,33,176,33,176,34,176,34,176,34,175,35,175,35,175,35,175,35,175,36,175,36,175,36,174,37,174,37,174,37,174,37,173,38,173,38,173,38,173,38,172,39,172,39,172,39,171,39,171,40,171,40,170,40,170,40,170,41,169,41,169,41,168,41,168,42,168,42,167,42,167,42,166,43,166,43,165,43,165,43,164,43,164,44,163,44,163,44,163,44,162,45,161,45,161,45,160,45,160,46,159,46,159,46,158,46,158,46,157,47,157,47,156,47,155,47,155,48,154,48,154,48,153,48,152,48,152,49,151,49,151,49,150,49,149,50,149,50,148,50,147,50,147,50,146,51,145,51,145,51,144,51,144,52,143,52,142,52,142,52,141,53,140,53,140,53,139,53,138,53,138,54,137,54,136,54,135,54,135,55,134,55,133,55,133,55,132,56,131,56,131,56,130,56,129,57,129,57,128,57,127,57,127,58,126,58,125,58,125,58,124,59,123,59,123,59,122,59,121,60,121,60,120,60,119,61,119,61,118,61,118,61,117,62,116,62,116,62,115,63,114,63,114,63,113,63,113,64,112,64,111,64,111,65,110,65,110,65,109,65,108,66,108,66,107,66,106,67,106,67,105,67,105,67,104,68,103,68,103,68,102,69,101,69,101,69,100,69,99,70,99,70,98,70,97,70,97,71,96,71,95,71,95,71,94,72,93,72,93,72,92,72,91,73,91,73,90,73,89,73,89,74,88,74,87,74,86,74,86,75,85,75,84,75,84,75,83,75,82,76,82,76,81,76,81,76,80,77,79,77,79,77,78,77,77,78,77,78,76,78,75,78,75,78,74,79,73,79,73,79,72,79,72,80,71,80,70,80,70,80,69,80,69,81,68,81,67,81,67,81,66,82,66,82,65,82,65,82,64,82,64,83,63,83,63,83,62,83,62,84,61,84,61,84,60,84,60,85,59,85,59,85,58,85,58,85,57,86,57,86,56,86,56,86,56,87,55,87,55,87,54,87,54,88,54,88,53,88,53,88,53,89,52,89,52,89,52,89,51,90,51,90,51,90,51,90,50,91,50,91,50,91,50,91,49,92,49,92,49,92,49,93,49,93,49,93,49,93,48,94,48,94,48,94,48,95,48,95,48,95,48,95,48,96,48,96,48,96,48,97,48,97,48,97,48,97,48,98,49,98,49,98,49,99,49,99,49,99,50,100,50,100,50,100,51,100,51,101,51,101,52,101,52,102,53,102,53,102,53,103,54,103,54,103,55,103,55,104,56,104,57,104,57,105,58,105,58,105,59,106,60,106,60,106,61,106,61,107,62,107,63,107,63,108,64,108,65,108,66,108,66,109,67,109,68,109,68,110,69,110,70,110,71,110,71,111,72,111,73,111,74,111,75,112,75,112,76,112,77,113,78,113,78,113,79,113,80,114,81,114,82,114,82,114,83,115,84,115,85,115,86,115,86,116,87,116,88,116,89,116,89,117,90,117,91,117,92,117,92,118,93,118,94,118,95,118,95,119,96,119,97,119,97,119,98,120,99,120,99,120,100,120,101,121,101,121,102,121,102,121,103,121,104,122,104,122,105,122,105,122,106,123,106,123,107,123,107,123,108,123,108,124,108,124,109,124,109,124,110,124,110,125,110,125,111,125,111,125,111,125,111,125,112,126,112,126,112,126,112,126,112,126,112,127,112,127,112,127,112,127,112,127,112,127,112,128,112,128,112,128,112,128,112,128,112,128,111,128,111,129,111,129,111,129,110,129,110,129,110,129,109,129,109,129,109,129,108,130,108,130,107,130,107,130,106,130,106,130,105,130,105,130,104,130,104,130,103,130,102,130,102,130,101,130,100,131,100,131,99,131,98,131,98,131,97,131,96,131,96,131,95,131,94,131,93,131,92,131,92,131,91,131,90,131,89,131,88,131,87,131,87,131,86,131,85,131,84,131,83,131,82,131,81,131,80,131,79,131,78,131,77,131,76,131,76,131,75,131,74,131,73,131,72,131,71,130,70,130,69,130,68,130,67,130,66,130,65,130,64,130,63,130,62,130,61,130,60,130,59,130,58,130,57,130,56,130,55,130,54,130,53,130,52,130,51,130,50,130,49,129,48,129,47,129,46,129,45,129,45,129,44,129,43,129,42,129,41,129,40,129,39,129,38,129,37,129,36,129,36,129,35,129,34,129,33,129,32,129,31,129,31,129,30,128,29,128,28,128,28,128,27,128,26,128,25,128,25,128,24,128,23,128,23,128,22,128,21,128,21,128,20,128,20,128,19,128,18,128,18,128,17,128,17,128,16,128,16,128};

// Enemy projectile types
static tEnemyProjectileType s_tEnemyProjectileTypes[ENEMY_PROJECTILE_TYPES] = {{ 10,  6, 0, 3},
                                                                               {  5,  6, 2, 3},
                                                                               {  8,  8, 4, 2},
                                                                               { 14, 14, 7, 2}};

// Player projectile types
static tPlayerProjectileType s_tPlayerProjectileTypes[PLAYER_PROJECTILE_TYPES] = {{ 20, 12, 0, 0, -6, 4, 0,  8,  7, TRUE, FALSE, FALSE, 0 },
                                                                                  { 15, 10, 0, 0, -6, 4, 0,  8, 10, TRUE, FALSE, FALSE, 0 },
                                                                                  { 10,  8, 0, 0, -7, 3, 0, 10, 12, FALSE, FALSE, FALSE, 0 },
                                                                                  { 10,  6, 0, 0, -8, 2, 0, 12, 16, TRUE, FALSE, FALSE, 0 }};

// Enemy types.
static tEnemyType s_tEnemyTypes[ENEMY_TYPES] = {{ 10, 16, 16,  3, 15, 0, 4, FALSE,   0, 0, 0, 1337},
                                                { 10, 16, 16,  3, 15, 0, 4,  TRUE,  50, 0, 0, 1337},
                                                { 20, 16, 16,  3, 15, 1, 4,  TRUE,  60, 1, 3, 1987},
                                                { 10, 16, 16,  3, 15, 2, 4, FALSE,   0, 0, 0, 1337},
                                                { 10, 16, 16,  3, 15, 2, 4,  TRUE,  50, 0, 0, 1337},
                                                { 20, 16, 16,  3, 15, 3, 4,  TRUE,  60, 1, 1, 1987},
                                                { 10, 16, 16,  3, 15, 4, 4, FALSE,   0, 0, 0, 1337},
                                                { 10, 16, 16,  3, 15, 4, 4,  TRUE,  50, 0, 0, 1337},
                                                { 20, 16, 16,  3, 15, 5, 4,  TRUE,  60, 1, 2, 1987},
                                                { 40, 32, 32, 16, 16, 0, 4,  TRUE,  40, 1, 0, 2600}};

// Enemy waves.
static UBYTE s_ubWavesInLevel[NUMBER_OF_LEVELS] = {235};
static tEnemyWave s_tEnemyWaves[] = {{ {  1,   0, 255, 255}, 2,  96, 3824, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 3808, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3792, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 3776, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3760, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 3744, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3728, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3712, 64, 7, FALSE },
                                     { {  1,   3, 255, 255}, 2,  96, 3696, 48, 0, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 3680, 48, 1, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128, 3664, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128, 3648, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128, 3632, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 3616, 64, 5, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 3600, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128, 3584, 64, 7, FALSE },
                                     { {  1,   3, 255, 255}, 2,  96, 3568, 48, 0, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 3552, 48, 1, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128, 3536, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128, 3520, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128, 3504, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 3488, 64, 5, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 3472, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128, 3456, 64, 7, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128, 3440, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128, 3424, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128, 3408, 64, 4, FALSE },
                                     { {  0,   4, 255, 255}, 2, 128, 3392, 64, 5, FALSE },
                                     { {  3,   1, 255, 255}, 2, 128, 3376, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128, 3360, 64, 7, FALSE },
                                     { {  5,   4, 255, 255}, 2,  96, 3344, 48, 0, FALSE },
                                     { {  4,   3, 255, 255}, 2,  96, 3328, 48, 1, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 3312, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 3296, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3280, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 3264, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3248, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 3232, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3216, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3200, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 3184, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 3168, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3152, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 3136, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3120, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 3104, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3088, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3072, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 3056, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 3040, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 3024, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 3008, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2992, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 2976, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2960, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2944, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 2928, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 2912, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2896, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 2880, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2864, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 2848, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2832, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2816, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 2800, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 2784, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2768, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 2752, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2736, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 2720, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2704, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2688, 64, 7, FALSE },
                                     { {  1,   3, 255, 255}, 2,  96, 2672, 48, 0, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 2656, 48, 1, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128, 2640, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128, 2624, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128, 2608, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 2592, 64, 5, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 2576, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128, 2560, 64, 7, FALSE },
                                     { {  1,   3, 255, 255}, 2,  96, 2544, 48, 0, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 2528, 48, 1, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128, 2512, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128, 2496, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128, 2480, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 2464, 64, 5, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 2448, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128, 2432, 64, 7, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128, 2416, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128, 2400, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128, 2384, 64, 4, FALSE },
                                     { {  0,   4, 255, 255}, 2, 128, 2368, 64, 5, FALSE },
                                     { {  3,   1, 255, 255}, 2, 128, 2352, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128, 2336, 64, 7, FALSE },
                                     { {  5,   4, 255, 255}, 2,  96, 2320, 48, 0, FALSE },
                                     { {  4,   3, 255, 255}, 2,  96, 2304, 48, 1, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 2288, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 2272, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2256, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 2240, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2224, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 2208, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2192, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2176, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 2160, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 2144, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2128, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 2112, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2096, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 2080, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2064, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2048, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 2032, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 2016, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 2000, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 1984, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1968, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 1952, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1936, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1920, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 1904, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 1888, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1872, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 1856, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1840, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 1824, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1808, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1792, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 1776, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 1760, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1744, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 1728, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1712, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 1696, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1680, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1664, 64, 7, FALSE },
                                     { {  1,   3, 255, 255}, 2,  96, 1648, 48, 0, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 1632, 48, 1, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128, 1616, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128, 1600, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128, 1584, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 1568, 64, 5, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 1552, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128, 1536, 64, 7, FALSE },
                                     { {  1,   3, 255, 255}, 2,  96, 1520, 48, 0, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 1504, 48, 1, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128, 1488, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128, 1472, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128, 1456, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 1440, 64, 5, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 1424, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128, 1408, 64, 7, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128, 1392, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128, 1376, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128, 1360, 64, 4, FALSE },
                                     { {  0,   4, 255, 255}, 2, 128, 1344, 64, 5, FALSE },
                                     { {  3,   1, 255, 255}, 2, 128, 1328, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128, 1312, 64, 7, FALSE },
                                     { {  5,   4, 255, 255}, 2,  96, 1296, 48, 0, FALSE },
                                     { {  4,   3, 255, 255}, 2,  96, 1280, 48, 1, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 1264, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 1248, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1232, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 1216, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1200, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 1184, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1168, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1152, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 1136, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96, 1120, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1104, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128, 1088, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1072, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128, 1056, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1040, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128, 1024, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96, 1008, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96,  992, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  976, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128,  960, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  944, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128,  928, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  912, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  896, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96,  880, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96,  864, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  848, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128,  832, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  816, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128,  800, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  784, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  768, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96,  752, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96,  736, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  720, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128,  704, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  688, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128,  672, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  656, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  640, 64, 7, FALSE },
                                     { {  1,   3, 255, 255}, 2,  96,  624, 48, 0, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96,  608, 48, 1, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128,  592, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128,  576, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128,  560, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128,  544, 64, 5, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128,  528, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128,  512, 64, 7, FALSE },
                                     { {  1,   3, 255, 255}, 2,  96,  496, 48, 0, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96,  480, 48, 1, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128,  464, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128,  448, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128,  432, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128,  416, 64, 5, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128,  400, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128,  384, 64, 7, FALSE },
                                     { {  0,   1, 255, 255}, 2, 128,  368, 64, 2, FALSE },
                                     { {  1,   1, 255, 255}, 2, 128,  352, 64, 3, FALSE },
                                     { {  2,   1, 255, 255}, 2, 128,  336, 64, 4, FALSE },
                                     { {  0,   4, 255, 255}, 2, 128,  320, 64, 5, FALSE },
                                     { {  3,   1, 255, 255}, 2, 128,  304, 64, 6, FALSE },
                                     { {  3,   4, 255, 255}, 2, 128,  288, 64, 7, FALSE },
                                     { {  5,   4, 255, 255}, 2,  96,  272, 48, 0, FALSE },
                                     { {  4,   3, 255, 255}, 2,  96,  256, 48, 1, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96,  240, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96,  224, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  208, 64, 2, FALSE },
                                     { {  2,   0, 255, 255}, 2, 128,  192, 64, 3, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  176, 64, 4, FALSE },
                                     { {  1,   0, 255, 255}, 2, 128,  160, 64, 5, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  144, 64, 6, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,  128, 64, 7, FALSE },
                                     { {  1,   0, 255, 255}, 2,  96,  112, 48, 0, FALSE },
                                     { {  0,   1, 255, 255}, 2,  96,   96, 48, 1, FALSE },
                                     { {  0,   0, 255, 255}, 2, 128,   80, 64, 2, FALSE }};

// Game states.

void gameGsCreate(void) {
    initGame();
    initViews();
    initAudio();
    initHud();
    initBobs();
    initSprites();

    gameMathInit();
    viewLoad(s_pView);
    tileBufferRedrawAll(s_pTileBuffer);
    memLogPeak();
    systemUnuse();
}

void gameGsLoop(void) {
    //g_pCustom->color[0] = 0xF00;
    ptplayerProcess();

    if (s_ubShowTextGameOver == TRUE && s_ubShowTextGameOverTimer == 0) {
        g_ulPlayerScore = s_ulPlayerScore;
        resetEverything();
        ptplayerSetMasterVolume(0);
        ptplayerEnableMusic(0);
        stateChange(g_pGameStateManager, &g_pGameStates[STATE_SCORE]);
        return;
    }

    // Process game logic.
    if (s_ubLevelStart == TRUE) {
        processLevelStart();
    } else {
        processInput();
    }

    processCamera();
    processWaves();
    processPlayer();
    processPlayerProjectiles();
    processEnemies();
    processSimpleEnemyProjectiles();
    processComplexEnemyProjectiles();
    processPowerups();
    processHud();
    processBobs();
    processTimers();

    // Wrap up processing frame.    
    tileBufferQueueProcess(s_pTileBuffer);
    viewProcessManagers(s_pView);
    copProcessBlocks();
    systemIdleBegin();
    vPortWaitForEnd(s_pGameViewport);
    systemIdleEnd();
}

void gameGsDestroy(void) {
    systemUse();
    
    // Destroy audio
    ptplayerStop();
    audioMixerDestroy();
    ptplayerModDestroy(s_pGameMusic);
    ptplayerSfxDestroy(s_pSfxLightLaser);
    ptplayerSfxDestroy(s_pSfxHeavyLaser);
    ptplayerSfxDestroy(s_pSfxFastLaser);
    ptplayerSfxDestroy(s_pSfxExplosion);
    ptplayerSfxDestroy(s_pSfxCollect);

    // Destroy font and text
    fontDestroyTextBitMap(s_pHudScoreText);
    fontDestroyTextBitMap(s_pHudLivesText);
    fontDestroyTextBitMap(s_pHudSpecialText);
    fontDestroyTextBitMap(s_pHudPowerText);
    fontDestroy(s_pFont);

    spriteManagerDestroy();
    
    for (UBYTE i=1; i<PLAYER_PROJECTILE_TYPES; i++) {
        copBlockDestroy(s_pView->pCopList, s_tPlayerProjectiles[i].pCopBlock);
        memFree(s_pPlayerProjectileSprites[i], sizeof(s_pPlayerProjectileSprites[i]));
    }

    bobManagerDestroy();

    // Destroy bitmaps
    for (UBYTE i=0; i<PLAYER_PROJECTILE_TYPES; i++) {
        bitmapDestroy(s_pPlayerProjectileImages[i]);
    }

    for (UBYTE i=0; i<ENEMY_PROJECTILE_TYPES; i++) {
        bitmapDestroy(s_pEnemyProjectileSpriteImage[i]);
    }

    bitmapDestroy(s_pHudIconsImage);
    bitmapDestroy(s_pHudIconsMask);
    bitmapDestroy(s_pPlayerImage);
    bitmapDestroy(s_pPlayerMask);
    bitmapDestroy(s_pEngineImage);
    bitmapDestroy(s_pEngineMask);
    bitmapDestroy(s_pEnemyImage);
    bitmapDestroy(s_pEnemyMask);
    bitmapDestroy(s_pSmallExplosionImage);
    bitmapDestroy(s_pSmallExplosionMask);
    bitmapDestroy(s_pBigExplosionImage);
    bitmapDestroy(s_pBigExplosionMask);
    bitmapDestroy(s_pPowerupsImage);
    bitmapDestroy(s_pPowerupsMask);
    bitmapDestroy(s_pEnemyProjectileBobsImage);
    bitmapDestroy(s_pEnemyProjectileBobsMask);
    bitmapDestroy(s_pTextGameOverImage);
    bitmapDestroy(s_pTextGameOverMask);
    bitmapDestroy(s_pTextReadyImage);
    bitmapDestroy(s_pTextReadyMask);
    bitmapDestroy(s_pTextGoImage);
    bitmapDestroy(s_pTextGoMask);
    bitmapDestroy(s_pTiles);
    viewDestroy(s_pView);
}

// Initialize game.

static void initGame() {
    //resetEverything();

    s_fViewportXMin = fix16_from_int(TILE_VIEWPORT_XMIN);
    s_fViewportXMax = fix16_from_int(TILE_VIEWPORT_XMAX);
    s_fBoundsMax = fix16_from_int(BOUNDS_MAX);
    s_fBoundsMin = fix16_from_int(BOUNDS_MIN);

    // Setup random number generator.
    //randInit(&s_tRandManager, 1337, 2600);

    // s_tPlayerProjectileTypes[] = (tPlayerProjectileType){ 5,  8, .bDeltaX =  0, .bDeltaX2 =  0, .bDeltaY = -8, .ubXOffset =  0, .ubXOffset2 = 16, .ubWidth = 31, .ubHeight = 20, .ubDieOnCollision = TRUE, .ubWideSprite = TRUE,  .ubSpreadShot = FALSE, .ubSecondarySpriteIndex = 0 }; // Wideshot
    // s_tPlayerProjectileTypes[] = (tPlayerProjectileType){ 25, 8, .bDeltaX = -5, .bDeltaX2 =  5, .bDeltaY = -5, .ubXOffset =  9, .ubXOffset2 = 16, .ubWidth =  7, .ubHeight =  8, .ubDieOnCollision = TRUE, .ubWideSprite = FALSE, .ubSpreadShot = TRUE,  .ubSecondarySpriteIndex = 1 }; // SpreadShot
}

static void initViews() {
    // Setup screen and viewports.
    s_pView = viewCreate(0,
        TAG_VIEW_GLOBAL_PALETTE, 1,
        TAG_VIEW_WINDOW_WIDTH, 160,
        TAG_VIEW_WINDOW_START_X, SCREEN_XOFFSET + 80,
    TAG_DONE);

    s_pGameViewport = vPortCreate(0,
        TAG_VPORT_VIEW, s_pView,
        TAG_VPORT_BPP, GAME_BPP,
        TAG_VPORT_HEIGHT, TILE_VIEWPORT_HEIGHT,
    TAG_DONE);

    s_pHudViewport = vPortCreate(0,
        TAG_VPORT_VIEW, s_pView,
        TAG_VPORT_BPP, GAME_BPP,
        TAG_VPORT_HEIGHT, HUD_VIEWPORT_HEIGHT,
    TAG_DONE);
 
    // Load palette
    paletteLoad("data/game.plt", s_uwFadePalette[15], 1 << GAME_BPP);
    for (UBYTE i=0; i<16; i++) {
        paletteDim(s_uwFadePalette[15], s_uwFadePalette[i], 32, i);
    }

    // Load tiles bitmap.
    s_pTiles = bitmapCreateFromFile("data/bigmap.bm", 0);

    // Init tilemap buffer.
    s_pTileBuffer = tileBufferCreate(0,
        TAG_TILEBUFFER_VPORT, s_pGameViewport,
        TAG_TILEBUFFER_BITMAP_FLAGS, BMF_CLEAR | BMF_INTERLEAVED,
        TAG_TILEBUFFER_BOUND_TILE_X, MAP_WIDTH_IN_TILES,
        TAG_TILEBUFFER_BOUND_TILE_Y, MAP_HEIGHT_IN_TILES,
        TAG_TILEBUFFER_IS_DBLBUF, 1,
        TAG_TILEBUFFER_TILE_SHIFT, 4,
        TAG_TILEBUFFER_REDRAW_QUEUE_LENGTH, 100,
        TAG_TILEBUFFER_TILESET, s_pTiles,
        TAG_TILEBUFFER_MAX_TILESET_SIZE, 215,
    TAG_DONE);

    // Init simple buffer.
    s_pHudBuffer = simpleBufferCreate(0,
        TAG_SIMPLEBUFFER_VPORT, s_pHudViewport,
        TAG_SIMPLEBUFFER_USE_X_SCROLLING, 0,
        TAG_SIMPLEBUFFER_IS_DBLBUF, 0,
        TAG_SIMPLEBUFFER_BITMAP_FLAGS, BMF_CLEAR,
    TAG_DONE);

    // Populate tilemap.
    UWORD idx = 0;
    for (UWORD y=0; y<MAP_HEIGHT_IN_TILES; y++) {
        for (UWORD x=0; x<MAP_WIDTH_IN_TILES; x++) {
            if (idx == MAP_TILES_COUNT) { idx = 0; }
            s_pTileBuffer->pTileData[x][y] = s_ubMapData[idx];
            idx++;
        }
    }

    // Setup camera.
    s_pCamera = s_pTileBuffer->pCamera;
    cameraMoveBy(s_pCamera, TILE_VIEWPORT_XMIN, CAMERA_START_YPOS);
}

static void initHud() {
    // Load font
    s_pFont = fontCreate("data/hudfont.fnt");
    s_pHudScoreText = fontCreateTextBitMap(HUD_SCORE_WIDTH, HUD_TEXT_HEIGHT);
    s_pHudLivesText = fontCreateTextBitMap(HUD_TEXT_WIDTH, HUD_TEXT_HEIGHT);
    s_pHudSpecialText = fontCreateTextBitMap(HUD_TEXT_WIDTH, HUD_TEXT_HEIGHT);
    s_pHudPowerText = fontCreateTextBitMap(HUD_TEXT_WIDTH, HUD_TEXT_HEIGHT);

    // Load HUD lives icon
    s_pHudIconsImage = bitmapCreateFromFile("data/hud_icons.bm", 0);
    s_pHudIconsMask = bitmapCreateFromFile("data/hud_icons_mask.bm", 0);
}

static void initAudio() {
    s_pSfxLightLaser = ptplayerSfxCreateFromFile("data/heavylaser.sfx", 1);
    s_pSfxHeavyLaser = ptplayerSfxCreateFromFile("data/heavylaser.sfx", 1);
    s_pSfxFastLaser = ptplayerSfxCreateFromFile("data/heavylaser.sfx", 1);
    s_pSfxExplosion = ptplayerSfxCreateFromFile("data/explosion.sfx", 1);
    s_pSfxCollect = ptplayerSfxCreateFromFile("data/collect.sfx", 1);
    ptplayerCreate(1);
    ptplayerSetChannelsForPlayer(0b0111);
    ptplayerSetMasterVolume(24);
    audioMixerCreate();
    s_pGameMusic = ptplayerModCreate("data/game.mod");
    ptplayerLoadMod(s_pGameMusic, 0, 0);
    ptplayerEnableMusic(1);
}

static void initBobs() {
    // Init tilemap bob manager.
    bobManagerCreate(s_pTileBuffer->pScroll->pFront, s_pTileBuffer->pScroll->pBack, s_pTileBuffer->pScroll->uwBmAvailHeight);

    // Player ship bob.
    s_pPlayerImage = bitmapCreateFromFile("data/player.bm", 0);
    s_pPlayerMask = bitmapCreateFromFile("data/player_mask.bm", 0);
    bobInit(&s_tPlayerBob, PLAYER_SHIP_WIDTH, PLAYER_SHIP_HEIGHT, 1, s_pPlayerImage->Planes[0], s_pPlayerMask->Planes[0], 0, 0);

    // Engine bob.
    s_pEngineImage = bitmapCreateFromFile("data/player_engine.bm", 0);
    s_pEngineMask = bitmapCreateFromFile("data/player_engine_mask.bm", 0);
    bobInit(&s_tEngineBob, ENGINE_WIDTH, ENGINE_HEIGHT, 1, s_pEngineImage->Planes[0], s_pEngineMask->Planes[0], 0, 0);

    // Enemy bobs
    s_pEnemyImage = bitmapCreateFromFile("data/enemy_small.bm", 0);
    s_pEnemyMask = bitmapCreateFromFile("data/enemy_small_mask.bm", 0);

    // Init enemy structs.
    for (UBYTE i=0; i<ENEMY_MAX; i++) {
        bobInit( &s_tEnemy[i].sBob, 16, 16, 1, s_pEnemyImage->Planes[0], s_pEnemyMask->Planes[0], 0, 0 );
        s_tEnemy[i].bHealth = 0;
    }

    // Small explosion bobs
    s_pSmallExplosionImage = bitmapCreateFromFile("data/explosion_small.bm", 0);
    s_pSmallExplosionMask = bitmapCreateFromFile("data/explosion_small_mask.bm", 0);

    for (UBYTE i=0; i<EXPLOSIONS_MAX; i++) {
        bobInit(&s_tExplosions[i].sBob, 16, 16, 1, s_pSmallExplosionImage->Planes[0], s_pSmallExplosionMask->Planes[0], 0, 0);
    }

    // Large explosion bob
    s_pBigExplosionImage = bitmapCreateFromFile("data/explosion_big.bm", 0);
    s_pBigExplosionMask = bitmapCreateFromFile("data/explosion_big_mask.bm", 0);

    bobInit(&s_tBigExplosionBob, 32, 32, 1, s_pBigExplosionImage->Planes[0], s_pBigExplosionMask->Planes[0], 0, 0);

    // Enemy projectiles.
    s_pEnemyProjectileBobsImage = bitmapCreateFromFile("data/enemy_bullet_bobs.bm", 0);
    s_pEnemyProjectileBobsMask = bitmapCreateFromFile("data/enemy_bullet_bobs_mask.bm", 0);

    for (UBYTE i=0; i<ENEMY_BOB_CHANNELS; i++) {
        bobInit(&s_tEnemyProjectileBob[i], 16, 14, 1, s_pEnemyProjectileBobsImage->Planes[0], s_pEnemyProjectileBobsMask->Planes[0], 0, 0);
    }

    s_pPowerupsImage = bitmapCreateFromFile("data/powerups_square.bm", 0);
    s_pPowerupsMask = bitmapCreateFromFile("data/powerups_square_mask.bm", 0);
    bobInit(&s_tLifePowBob, 16, 16, 1, s_pPowerupsImage->Planes[0], s_pPowerupsMask->Planes[0], 0, 0); // Extra Life Powerup   
    bobInit(&s_tSpecialPowBob, 16, 16, 1, s_pPowerupsImage->Planes[0], s_pPowerupsMask->Planes[0], 0, 0); // Special Powerup
    bobInit(&s_tWeaponPowBob, 16, 16, 1, s_pPowerupsImage->Planes[0], s_pPowerupsMask->Planes[0], 0, 0); // Weapon Powerup

    bobSetFrame(&s_tLifePowBob, &s_pPowerupsImage->Planes[0][0], &s_pPowerupsMask->Planes[0][0]);
    bobSetFrame(&s_tSpecialPowBob, &s_pPowerupsImage->Planes[0][160], &s_pPowerupsMask->Planes[0][160]);
    bobSetFrame(&s_tWeaponPowBob, &s_pPowerupsImage->Planes[0][320], &s_pPowerupsMask->Planes[0][320]);

    // Game Over text
    s_pTextGameOverImage = bitmapCreateFromFile("data/text_gameover.bm", 0);
    s_pTextGameOverMask = bitmapCreateFromFile("data/text_gameover_mask.bm", 0);
    bobInit(&s_tTextGameOverBob, 112, 60, 0, s_pTextGameOverImage->Planes[0], s_pTextGameOverMask->Planes[0], 0, 0);

    // Ready text
    s_pTextReadyImage = bitmapCreateFromFile("data/text_ready.bm", 0);
    s_pTextReadyMask = bitmapCreateFromFile("data/text_ready_mask.bm", 0);
    bobInit(&s_tTextReadyBob, 144, 27, 1, s_pTextReadyImage->Planes[0], s_pTextReadyMask->Planes[0], 0, 0);

    // Go text
    s_pTextGoImage = bitmapCreateFromFile("data/text_go.bm", 0);
    s_pTextGoMask = bitmapCreateFromFile("data/text_go_mask.bm", 0);
    bobInit(&s_tTextGoBob, 64, 38, 1, s_pTextGoImage->Planes[0], s_pTextGoMask->Planes[0], 0, 0);

    // Finish bob init.
    bobReallocateBgBuffers();
}

static void initSprites() {
    // Init sprites.
    spriteManagerCreate(s_pView, 0);
    systemSetDmaBit(DMAB_SPRITE, 1);

    // Enemy projectile sprites.
    s_pEnemyProjectileSpriteImage[0] = bitmapCreateFromFile("data/enemy_bullet_sprite_1.bm", 0);
    s_pEnemyProjectileSpriteImage[1] = bitmapCreateFromFile("data/enemy_bullet_sprite_2.bm", 0);
    s_pEnemyProjectileSpriteImage[2] = bitmapCreateFromFile("data/enemy_bullet_sprite_3.bm", 0);
    s_pEnemyProjectileSpriteImage[3] = bitmapCreateFromFile("data/enemy_bullet_sprite_4.bm", 0);

    s_pEnemyProjectileSprite[0] = spriteAdd(0, s_pEnemyProjectileSpriteImage[0]);
    s_pEnemyProjectileSprite[1] = spriteAdd(1, s_pEnemyProjectileSpriteImage[1]);
    s_pEnemyProjectileSprite[2] = spriteAdd(2, s_pEnemyProjectileSpriteImage[2]);
    s_pEnemyProjectileSprite[3] = spriteAdd(3, s_pEnemyProjectileSpriteImage[3]);

    s_tSimpleChannelBounds[0] = (tSimpleChannelBounds){.uwMin = BOUNDS_MAX, .uwMax = BOUNDS_MIN};
    s_tSimpleChannelBounds[1] = (tSimpleChannelBounds){.uwMin = BOUNDS_MAX, .uwMax = BOUNDS_MIN};
    s_tSimpleChannelBounds[2] = (tSimpleChannelBounds){.uwMin = BOUNDS_MAX, .uwMax = BOUNDS_MIN};
    s_tSimpleChannelBounds[3] = (tSimpleChannelBounds){.uwMin = BOUNDS_MAX, .uwMax = BOUNDS_MIN};

    for (UBYTE i=0; i<ENEMY_PROJECTILE_MAX; i++) {
        s_tComplexEnemyProjectiles[i].pCopBlock = copBlockCreate(s_pView->pCopList, 4, 0, 0);
        s_tSimpleEnemyProjectiles[i].pCopBlock = copBlockCreate(s_pView->pCopList, 4, 0, 0);
    }

    // Player projectile sprite.   
    s_pPlayerProjectileImages[0] = bitmapCreateFromFile("data/player_bullet_sprite_1.bm", 0);
    s_pPlayerProjectileImages[1] = bitmapCreateFromFile("data/player_bullet_sprite_2.bm", 0);
    s_pPlayerProjectileImages[2] = bitmapCreateFromFile("data/player_bullet_sprite_3.bm", 0);
    s_pPlayerProjectileImages[3] = bitmapCreateFromFile("data/player_bullet_sprite_4.bm", 0);
    
    s_pPlayerProjectileSprites[0] = spriteAdd(4, s_pPlayerProjectileImages[0]);
    s_pPlayerProjectileSprites[1] = spriteAdd(4, s_pPlayerProjectileImages[1]);
    s_pPlayerProjectileSprites[2] = spriteAdd(4, s_pPlayerProjectileImages[2]);
    s_pPlayerProjectileSprites[3] = spriteAdd(4, s_pPlayerProjectileImages[3]);

    // s_pPlayerSecondaryProjectileImages[0] = bitmapCreateFromFile("data/bullet6b_sprite_player.bm", 0); // Wide shot
    // s_pPlayerSecondaryProjectileImages[1] = bitmapCreateFromFile("data/bullet7r_sprite_player.bm", 0); // Spread shot

    // s_pPlayerSecondaryProjectileSprites[0] = spriteAdd(5, s_pPlayerSecondaryProjectileImages[0]);
    // s_pPlayerSecondaryProjectileSprites[1] = spriteAdd(5, s_pPlayerSecondaryProjectileImages[1]);

    for (UBYTE i=0; i<PLAYER_PROJECTILE_MAX; i++) {
        s_tPlayerProjectiles[i].pCopBlock = copBlockCreate(s_pView->pCopList, 4, 0, 0);
        //s_tPlayerSecondaryProjectiles[i].pCopBlock = copBlockCreate(s_pView->pCopList, 4, 0, 0);
    }
}

// Process game logic.

static void processLevelStart() {
    s_ubLevelStartTimer--; 

    if (s_ubDimLevel < 15) {
        for (UBYTE i=0; i<32; i++) {
            s_pGameViewport->pPalette[i] = s_uwFadePalette[s_ubDimLevel][i];
        }

        viewUpdateGlobalPalette(s_pView);
        s_ubDimLevel++;      
    }

    if (s_ubLevelStartTimer > 64) {
        s_ubShowTextReady = TRUE;
    }

    if (s_ubLevelStartTimer > 0 && s_ubLevelStartTimer <= 64) {
        s_ubShowTextReady = FALSE;
        s_ubShowTextGo = TRUE;
        s_ubCameraCanMove = TRUE; 
    }

    if (s_ubLevelStartTimer == 0) { 
        s_ubShowTextReady = FALSE;
        s_ubShowTextGo = FALSE;
        s_ubLevelStart = FALSE;
        s_ubCameraCanMove = TRUE;
    }
}

static void processCamera() {
    if (s_ubCameraCanMove == TRUE) {
        s_ubMoveCameraCounter++;

        if (s_ubMoveCameraCounter >= CAMERA_MOVE_RATE) { 
            if (s_pCamera->uPos.uwY > CAMERA_Y_MIN) { 
                cameraMoveBy(s_pCamera, 0, CAMERA_MOVE_AMOUNT);

                if (s_ubPlayerMovedOnY == FALSE) {
                    s_tPlayerPosition.uwY += CAMERA_MOVE_AMOUNT;
                }                 
            }
            s_ubMoveCameraCounter = 0;
        }

        // Keep player inside camera area.
        UWORD uwCameraYMax = s_pCamera->uPos.uwY+TILE_VIEWPORT_HEIGHT;
        if (s_tPlayerPosition.uwY+PLAYER_SHIP_HEIGHT > uwCameraYMax) {
            s_tPlayerPosition.uwY = uwCameraYMax - PLAYER_SHIP_HEIGHT;
        }

        if (s_pCamera->uPos.uwY == CAMERA_Y_MIN) {
            s_ubPlayerLives = 1;
            processPlayerDie();
        }        
    }
}

static void processInput() {
    if (keyCheck(KEY_ESCAPE)) {
        gameExit();
    }

    // Move
    s_ubPlayerMovedOnY = FALSE;
    s_ubPlayerMovedLeft = FALSE;
    s_ubPlayerMovedRight = FALSE;
    s_ubDisplayEngine = TRUE;

    if (keyCheck(KEY_UP) || joyCheck(JOY1_UP)) {
        s_tPlayerPosition.uwY = s_tPlayerPosition.uwY - PLAYER_MOVE_SPEED;
        s_ubPlayerMovedOnY = TRUE;
        if (s_tPlayerPosition.uwY < s_pCamera->uPos.uwY + TILE_VIEWPORT_YMIN) { s_tPlayerPosition.uwY = s_pCamera->uPos.uwY + TILE_VIEWPORT_YMIN; }
    }
    if (keyCheck(KEY_DOWN) || joyCheck(JOY1_DOWN)) {
        s_tPlayerPosition.uwY = s_tPlayerPosition.uwY + (PLAYER_MOVE_SPEED-1);
        s_ubPlayerMovedOnY = TRUE;
        s_ubDisplayEngine = FALSE;
        if (s_tPlayerPosition.uwY > s_pCamera->uPos.uwY + (TILE_VIEWPORT_HEIGHT-PLAYER_SHIP_HEIGHT)) { s_tPlayerPosition.uwY = s_pCamera->uPos.uwY + (TILE_VIEWPORT_HEIGHT-PLAYER_SHIP_HEIGHT); }
    }
    if (keyCheck(KEY_LEFT) || joyCheck(JOY1_LEFT)) {
        s_tPlayerPosition.uwX = s_tPlayerPosition.uwX - PLAYER_MOVE_SPEED;
        s_ubPlayerMovedLeft = TRUE;
        if (s_tPlayerPosition.uwX < TILE_VIEWPORT_XMIN) { s_tPlayerPosition.uwX = TILE_VIEWPORT_XMIN; }
    }
    if (keyCheck(KEY_RIGHT) || joyCheck(JOY1_RIGHT)) {
        s_tPlayerPosition.uwX = s_tPlayerPosition.uwX + PLAYER_MOVE_SPEED;
        s_ubPlayerMovedLeft = FALSE;
        s_ubPlayerMovedRight = TRUE;
        if (s_tPlayerPosition.uwX > (TILE_VIEWPORT_XMAX-PLAYER_SHIP_WIDTH)) { s_tPlayerPosition.uwX = (TILE_VIEWPORT_XMAX-PLAYER_SHIP_WIDTH); }
    }

    // Shoot
    if (keyCheck(KEY_SPACE) || joyCheck(JOY1_FIRE)) {
        processPlayerShoot();
    }

    // Special
    if (keyCheck(KEY_B) || joyCheck(JOY1_FIRE2)) {
        processPlayerSpecial();
    }
}

static void processHud() {
    // Lives
    if (s_ubUpdateLives == TRUE) {
        char cLives[4];
        sprintf(cLives, "%01d", s_ubPlayerLives);
        fontFillTextBitMap(s_pFont, s_pHudLivesText, cLives);
        fontDrawTextBitMap(s_pHudBuffer->pBack, s_pHudLivesText, 14, 3, HUD_TEXT_COLOR, 0);
        blitCopyMask(s_pHudIconsImage, 0, 0, s_pHudBuffer->pBack, 4, 3, 8, 7, s_pHudIconsMask->Planes[0]);
        s_ubUpdateLives = FALSE;
    }

    // Special
    if (s_ubUpdateSpecial == TRUE) {
        char cSpecial[4];
        sprintf(cSpecial, "%01d", s_ubPlayerSpecial);
        fontFillTextBitMap(s_pFont, s_pHudSpecialText, cSpecial);
        fontDrawTextBitMap(s_pHudBuffer->pBack, s_pHudSpecialText, 42, 3, HUD_TEXT_COLOR, 0);
        blitCopyMask(s_pHudIconsImage, 0, 7, s_pHudBuffer->pBack, 32, 3, 8, 7, s_pHudIconsMask->Planes[0]);
        s_ubUpdateSpecial = FALSE;
        s_ubUpdatePower = TRUE;
    }    

    // Power
    if (s_ubUpdatePower == TRUE) {
        char cPlayerPower[4];
        sprintf(cPlayerPower, "%01d", s_ubEquippedProjectileType);
        fontFillTextBitMap(s_pFont, s_pHudPowerText, cPlayerPower);
        fontDrawTextBitMap(s_pHudBuffer->pBack, s_pHudPowerText, 69, 3, HUD_TEXT_COLOR, 0);
        blitCopyMask(s_pHudIconsImage, 0, 14, s_pHudBuffer->pBack, 58, 3, 8, 7, s_pHudIconsMask->Planes[0]);
        s_ubUpdatePower = FALSE;
    }

    // Score
    if (s_ubUpdateScore == TRUE) {
        char cPlayerScore[12];
        sprintf(cPlayerScore, "%07ld", s_ulPlayerScore);
        fontFillTextBitMap(s_pFont, s_pHudScoreText, cPlayerScore);
        fontDrawTextBitMap(s_pHudBuffer->pBack, s_pHudScoreText, 94, 3, HUD_TEXT_COLOR, 0);
        s_ubUpdateScore = FALSE;
    }
}

static void processWaves() {
    if (s_ubWaveIndex != 255) {
        if (s_pCamera->uPos.uwY == s_tEnemyWaves[s_ubWaveIndex].uwSpawnYPosition) {
            if (s_ubActiveEnemies + s_tEnemyWaves[s_ubWaveIndex].ubNumberOfEnemies <= ENEMY_MAX) {
                UBYTE ubPathIdxSpacingOffset = 0;
                for (UBYTE spawnIdx=0; spawnIdx<s_tEnemyWaves[s_ubWaveIndex].ubNumberOfEnemies; spawnIdx++) {
                    UBYTE ubEnemyTypeToSpawn = s_tEnemyWaves[s_ubWaveIndex].ubEnemies[spawnIdx];
                    if (ubEnemyTypeToSpawn == 255) {
                        ubPathIdxSpacingOffset += s_tEnemyWaves[s_ubWaveIndex].ubSpacing;
                        continue;
                    }
                    
                    logWrite("Wave[%d] %d/%d Spawn EnemyType: %d", s_ubWaveIndex, spawnIdx, s_tEnemyWaves[s_ubWaveIndex].ubNumberOfEnemies, ubEnemyTypeToSpawn);
                    for (UBYTE enemyIdx=0; enemyIdx<ENEMY_MAX; enemyIdx++) {
                        if (s_tEnemy[enemyIdx].bHealth > 0) { continue; }
                        UBYTE ubPathType = s_tEnemyWaves[s_ubWaveIndex].ubPathType;
                        s_tEnemy[enemyIdx].bHealth = s_tEnemyTypes[ubEnemyTypeToSpawn].bHealth;
                        s_tEnemy[enemyIdx].ubOnScreen = FALSE;
                        s_tEnemy[enemyIdx].ubInvincible = TRUE;
                        s_tEnemy[enemyIdx].ubCanShoot = s_tEnemyTypes[ubEnemyTypeToSpawn].ubCanShoot;
                        s_tEnemy[enemyIdx].ubCooldownTimer = s_tEnemyTypes[ubEnemyTypeToSpawn].ubCooldownTime;
                        s_tEnemy[enemyIdx].ubEnemyType = ubEnemyTypeToSpawn;
                        s_tEnemy[enemyIdx].ubPowerupType = s_tEnemyTypes[ubEnemyTypeToSpawn].ubPowerupType;
                        s_tEnemy[enemyIdx].ubWaveIdx = s_ubWaveIndex;
                        s_tEnemy[enemyIdx].uwScoreValue = s_tEnemyTypes[ubEnemyTypeToSpawn].uwScoreValue;
                        s_tEnemy[enemyIdx].ubMoveSpeed = s_tEnemyTypes[ubEnemyTypeToSpawn].ubMoveSpeed;
                        s_tEnemy[enemyIdx].uwPathArrayOffset = s_uwPathOffset[ubPathType];
                        s_tEnemy[enemyIdx].uwPathLength = s_uwPathLength[ubPathType];
                        s_tEnemy[enemyIdx].ubPathLoops = s_tEnemyWaves[s_ubWaveIndex].ubPathLoops;
                        s_tEnemy[enemyIdx].uwPathYOffset = s_tEnemyWaves[s_ubWaveIndex].uwSpawnYPosition - s_tEnemyWaves[s_ubWaveIndex].uwPathYOffset;
                        s_tEnemy[enemyIdx].uwPathIdx = ubPathIdxSpacingOffset;
                        ubPathIdxSpacingOffset += s_tEnemyWaves[s_ubWaveIndex].ubSpacing;

                        UBYTE ubBitmapOffsetIdx = s_tEnemyTypes[ubEnemyTypeToSpawn].ubBitmapOffset;
                        UWORD uwOffset = s_uwEnemyBitmapOffset[ubBitmapOffsetIdx];
                        bobSetFrame(
                            &s_tEnemy[enemyIdx].sBob,
                            &s_pEnemyImage->Planes[0][uwOffset],
                            &s_pEnemyMask->Planes[0][uwOffset]
                        );

                        logWrite("Wave[%d] Spawned %d:%d to EnemyIdx:%d", s_ubWaveIndex, spawnIdx, ubEnemyTypeToSpawn, enemyIdx);
                        s_ubActiveEnemies++;
                        break;
                    }
                }
            } else {
                logWrite("Wave[%d] Too many enemies => Active:%d Spawn:%d", s_ubWaveIndex, s_ubActiveEnemies, s_tEnemyWaves[s_ubWaveIndex].ubNumberOfEnemies);
            }

            s_ubWaveIndex++;
            if (s_ubWaveIndex >= s_ubWavesInLevel[s_ubCurrentLevel]) {
                logWrite("No more waves left!");
                s_ubWaveIndex = 255;
            }
        }
    }
}

static void processBobs() {
    systemSetDmaBit(DMAB_BLITHOG, 1);
    bobBegin(s_pTileBuffer->pScroll->pBack);

    // Player ship
    if (s_ubPlayerAlive == TRUE) {
        s_tPlayerBob.sPos = s_tPlayerPosition;
        
        if (s_ubPlayerMovedLeft == TRUE) {
            bobSetFrame(
                &s_tPlayerBob,
                &s_pPlayerImage->Planes[0][PLAYER_SHIP_LEFT_FRAME],
                &s_pPlayerMask->Planes[0][PLAYER_SHIP_LEFT_FRAME]
            );
        }

        if (s_ubPlayerMovedRight == TRUE) {
            bobSetFrame(
                &s_tPlayerBob,
                &s_pPlayerImage->Planes[0][PLAYER_SHIP_RIGHT_FRAME],
                &s_pPlayerMask->Planes[0][PLAYER_SHIP_RIGHT_FRAME]
            );
        }

        if (s_ubPlayerMovedLeft == FALSE && s_ubPlayerMovedRight == FALSE) {
            bobSetFrame(
                &s_tPlayerBob,
                &s_pPlayerImage->Planes[0][PLAYER_SHIP_CENTER_FRAME],
                &s_pPlayerMask->Planes[0][PLAYER_SHIP_CENTER_FRAME]
            );
        }

        if (s_ubDisplayPlayer == TRUE) {
            bobPush(&s_tPlayerBob);
        }

        // Engine
        if (s_ubDisplayPlayer == TRUE && s_ubDisplayEngine == TRUE) {
            s_tEngineBob.sPos = s_tPlayerPosition;
            s_tEngineBob.sPos.uwY += 16;
            UBYTE ubFrameOffset = s_uwEngineAnimOffset[s_ubEngineAnimFrame];
            bobSetFrame(
                &s_tEngineBob,
                &s_pEngineImage->Planes[0][ubFrameOffset],
                &s_pEngineMask->Planes[0][ubFrameOffset]
            );
            bobPush(&s_tEngineBob);       
        }
    }

    // Extra Life Powerup
    if (s_ubLifePowActive == TRUE) { bobPush(&s_tLifePowBob); }

    // Special Powerup
    if (s_ubSpecialPowActive == TRUE) { bobPush(&s_tSpecialPowBob); }

    // Weapon Powerup
    if (s_ubWeaponPowActive == TRUE) { bobPush(&s_tWeaponPowBob); }

    // Enemies
    if (s_ubActiveEnemies > 0) {
        for (UBYTE enemyIdx=0; enemyIdx<ENEMY_MAX; enemyIdx++) {
            if (s_tEnemy[enemyIdx].bHealth == 0 || s_tEnemy[enemyIdx].ubOnScreen == FALSE) { continue; }
            //UBYTE bufferCheck = tileBufferIsRectFullyOnBuffer(s_pTileBuffer, s_tEnemy[enemyIdx].sBob.sPos.uwX, s_tEnemy[enemyIdx].sBob.sPos.uwY, 16, 16);           
            //if (bufferCheck == TRUE) { bobPush(&s_tEnemy[enemyIdx].sBob); }
            bobPush(&s_tEnemy[enemyIdx].sBob);
        }
    }

    // Explosions
    if (s_ubActiveExplosions > 0) {
        for (UBYTE explosionIdx=0; explosionIdx < EXPLOSIONS_MAX; explosionIdx++) {
            if (s_tExplosions[explosionIdx].ubAlive == 0) { continue; }
            UBYTE ubFrameIdx = s_tExplosions[explosionIdx].ubFrameIndex;
            UWORD uwAnimOffset = s_uwSmallExplosionAnimOffset[ubFrameIdx];

            bobSetFrame(
                &s_tExplosions[explosionIdx].sBob,
                &s_pSmallExplosionImage->Planes[0][uwAnimOffset],
                &s_pSmallExplosionMask->Planes[0][uwAnimOffset]
            );

            bobPush(&s_tExplosions[explosionIdx].sBob);
        }        
    }

    // Big Explosion
    if (s_ubBigExplosionActive == 1) {
        bobSetFrame(
            &s_tBigExplosionBob,
            &s_pBigExplosionImage->Planes[0][s_uwBigExplosionAnimOffset[s_ubBigExplosionFrame]],
            &s_pBigExplosionMask->Planes[0][s_uwBigExplosionAnimOffset[s_ubBigExplosionFrame]]
        );

        bobPush(&s_tBigExplosionBob);        
    }

    // Enemy projectiles
    if (s_ubProjectileBobIndex > 0) {
        for (UBYTE projectileIdx=0; projectileIdx<s_ubProjectileBobIndex; projectileIdx++) {
            UBYTE ubType = s_ubEnemyProjectileBobTypes[projectileIdx];
            UWORD uwOffset = s_uwEnemyProjectileBitmapOffset[ubType];
            
            bobSetFrame(
                &s_tEnemyProjectileBob[projectileIdx],
                &s_pEnemyProjectileBobsImage->Planes[0][uwOffset],
                &s_pEnemyProjectileBobsMask->Planes[0][uwOffset]
            );

            bobPush(&s_tEnemyProjectileBob[projectileIdx]);
        }
    }
    
    // Game Over text
    if (s_ubShowTextGameOver == TRUE) {
        s_tTextGameOverBob.sPos.uwX = 57; 
        s_tTextGameOverBob.sPos.uwY = s_pCamera->uPos.uwY+99;
        bobPush(&s_tTextGameOverBob);
    }

    // Ready text
    if (s_ubShowTextReady == TRUE) {
        s_tTextReadyBob.sPos.uwX = 41; 
        s_tTextReadyBob.sPos.uwY = s_pCamera->uPos.uwY+115;
        bobPush(&s_tTextReadyBob);
    }

    // Go text
    if (s_ubShowTextGo == TRUE) {
        s_tTextGoBob.sPos.uwX = 81; 
        s_tTextGoBob.sPos.uwY = s_pCamera->uPos.uwY+110;
        bobPush(&s_tTextGoBob);
    }

    bobEnd();
    systemSetDmaBit(DMAB_BLITHOG, 0);
}

static void processTimers() {
    // System
    s_ubFrameCounter = !s_ubFrameCounter;
    s_ubFlashTimer++;

    UBYTE ubFlashTimeout = FLASH_TIME;
    if (s_ubPlayerInvincibleTimer <= 25) {
        ubFlashTimeout = 2;
    } 

    if (s_ubFlashTimer >= ubFlashTimeout) { 
        s_ubFlashTimer = 0; 
        s_ubFlashOn = !s_ubFlashOn;
    }

    if (s_ubShowTextGameOver == TRUE && s_ubShowTextGameOverTimer > 0) { s_ubShowTextGameOverTimer--; }

    // Player
    s_ubEngineAnimFrame++; s_ubEngineAnimFrame = s_ubEngineAnimFrame % ENGINE_ANIM_FRAMES;
    if (s_ubFireDelay > 0) { s_ubFireDelay--; }
    if (s_ubSpecialDelay > 0) { s_ubSpecialDelay--; }
    if (s_ubAudioDelay > 0) { s_ubAudioDelay--; }
    if (s_ubPlayerInvincibleTimer > 0) { s_ubPlayerInvincibleTimer--; }


    // Explosions
    if (s_ubActiveExplosions > 0) {
        for (UBYTE explosionIdx=0; explosionIdx < EXPLOSIONS_MAX; explosionIdx++) {
            if (s_tExplosions[explosionIdx].ubAlive == 0) { continue; }
            s_tExplosions[explosionIdx].ubFrameIndex++;
            if (s_tExplosions[explosionIdx].ubFrameIndex == EXPLOSION_ANIM_FRAMES) {
                s_tExplosions[explosionIdx].ubAlive = 0;
                s_ubActiveExplosions--;
            }
        }        
    }

    // Big Explosion
    if (s_ubBigExplosionActive == 1) {
        s_ubBigExplosionFrame++;
        if (s_ubBigExplosionFrame == BIGEXPLOSION_ANIM_FRAMES) {
            s_ubBigExplosionActive = 0;
            s_ubBigExplosionFrame = 0;
        }
    }
}

static void processPowerups() {
    // Extra life
    if (s_ubLifePowActive == TRUE) {
        s_tLifePowBob.sPos.uwY += POWERUP_FALL_SPEED;

        // Check if offscreen.
        if (s_tLifePowBob.sPos.uwY > s_pCamera->uPos.uwY+TILE_VIEWPORT_HEIGHT) {
            s_ubLifePowActive = FALSE;
            return;
        }

        #ifndef COLLISIONS_DISABLED
        UBYTE ubCollision = checkCollision(s_tPlayerPosition.uwX, s_tPlayerPosition.uwY, PLAYER_SHIP_WIDTH, PLAYER_SHIP_HEIGHT, 
                                           s_tLifePowBob.sPos.uwX, s_tLifePowBob.sPos.uwY, POWERUP_WIDTH, POWERUP_HEIGHT);
        if (ubCollision == TRUE && s_ubPlayerAlive == TRUE) {
            audioMixerPlaySfx(s_pSfxCollect, CHANNEL_FOR_PLAYER, 9, 0);
            if (s_ubPlayerLives < PLAYER_LIVES_MAX) {
                s_ubPlayerLives++;
                s_ubUpdateLives = TRUE;
            } else {
                s_ulPlayerScore += POWERUP_SCORE;
                s_ubUpdateScore = TRUE;
            }
            s_ubLifePowActive = FALSE;
        }
        #endif

        return;
    }

    // Special
    if (s_ubSpecialPowActive == TRUE) {
        s_tSpecialPowBob.sPos.uwY += POWERUP_FALL_SPEED;

        // Check if offscreen.
        if (s_tSpecialPowBob.sPos.uwY > s_pCamera->uPos.uwY+TILE_VIEWPORT_HEIGHT) {
            s_ubSpecialPowActive = FALSE;
            return;
        }

        #ifndef COLLISIONS_DISABLED
        UBYTE ubCollision = checkCollision(s_tPlayerPosition.uwX, s_tPlayerPosition.uwY, PLAYER_SHIP_WIDTH, PLAYER_SHIP_HEIGHT, 
                                           s_tSpecialPowBob.sPos.uwX, s_tSpecialPowBob.sPos.uwY, POWERUP_WIDTH, POWERUP_HEIGHT);
        if (ubCollision == TRUE && s_ubPlayerAlive == TRUE) { 
            audioMixerPlaySfx(s_pSfxCollect, CHANNEL_FOR_PLAYER, 9, 0);
            if (s_ubPlayerSpecial < PLAYER_SPECIAL_MAX) {
                s_ubPlayerSpecial++;
                s_ubUpdateSpecial = TRUE;
            } else {
                s_ulPlayerScore += POWERUP_SCORE;
                s_ubUpdateScore = TRUE;
            }
            s_ubSpecialPowActive = FALSE;
        }
        #endif

        return;
    }

    // Weapon
    if (s_ubWeaponPowActive == TRUE) {
        s_tWeaponPowBob.sPos.uwY += POWERUP_FALL_SPEED;

        // Check if offscreen.
        if (s_tWeaponPowBob.sPos.uwY > s_pCamera->uPos.uwY+TILE_VIEWPORT_HEIGHT) {
            s_ubWeaponPowActive = FALSE;
            return;
        }

        #ifndef COLLISIONS_DISABLED
        UBYTE ubCollision = checkCollision(s_tPlayerPosition.uwX, s_tPlayerPosition.uwY, PLAYER_SHIP_WIDTH, PLAYER_SHIP_HEIGHT, 
                                           s_tWeaponPowBob.sPos.uwX, s_tWeaponPowBob.sPos.uwY, POWERUP_WIDTH, POWERUP_HEIGHT);
        if (ubCollision == TRUE && s_ubPlayerAlive == TRUE) {
            audioMixerPlaySfx(s_pSfxCollect, CHANNEL_FOR_PLAYER, 9, 0);
            if (s_ubEquippedProjectileType < (PLAYER_PROJECTILE_TYPES-1)) {
                s_ubEquippedProjectileType++;
                s_ubUpdatePower = TRUE;
            } else {
                s_ulPlayerScore += POWERUP_SCORE;
                s_ubUpdateScore = TRUE;
            }
            s_ubWeaponPowActive = FALSE;
        }
        #endif

        return;
    }
}

static void processPlayer() {
    if (s_ubPlayerIsInvincible == TRUE) {
        if (s_ubPlayerInvincibleTimer == 0) {
            s_ubPlayerIsInvincible = FALSE;
            s_ubDisplayPlayer = TRUE;
        } else {
            if (s_ubFlashOn == TRUE) {
                s_ubDisplayPlayer = TRUE;
            } else {
                s_ubDisplayPlayer = FALSE;
            }
        }
    }

    // Respawn player.
    if (s_ubPlayerAlive == FALSE && s_ubPlayerLives > 0 && s_ubBigExplosionActive == FALSE) {
        s_tPlayerPosition.uwX = s_pCamera->uPos.uwX+(80 - (PLAYER_SHIP_WIDTH/2));
        s_tPlayerPosition.uwY = s_pCamera->uPos.uwY+192;
        s_ubPlayerAlive = TRUE;
        s_ubPlayerIsInvincible = TRUE;
        s_ubPlayerInvincibleTimer = PLAYER_INVINCIBLE_TIME;
    }

    if (s_ubPlayerLives == 0) {
        s_ubPlayerAlive = FALSE;
        s_ubCameraCanMove = FALSE;
        s_ubShowTextGameOver = TRUE;
    }
}

static void processEnemies() {
    if (s_ubActiveEnemies == 0) { return; }

    UWORD uwCameraYMin = s_pCamera->uPos.uwY;
    UWORD uwCameraYMax = s_pCamera->uPos.uwY+TILE_VIEWPORT_HEIGHT;
    UWORD uwCameraXMin = TILE_VIEWPORT_XMIN;
    UWORD uwCameraXMax = TILE_VIEWPORT_XMAX;

    for (UBYTE enemyIdx=0; enemyIdx<ENEMY_MAX; enemyIdx++) {
        if (s_tEnemy[enemyIdx].bHealth == 0) { continue; }
        
        UBYTE ubEnemyType = s_tEnemy[enemyIdx].ubEnemyType;

        // Move
        s_tEnemy[enemyIdx].uwPathIdx += s_tEnemy[enemyIdx].ubMoveSpeed;

        if (s_tEnemy[enemyIdx].uwPathIdx >= s_tEnemy[enemyIdx].uwPathLength-1) {
            if (s_tEnemy[enemyIdx].ubPathLoops == TRUE) {
                s_tEnemy[enemyIdx].uwPathIdx = 0;
            } else {
                s_tEnemy[enemyIdx].bHealth = 0;
                s_tEnemy[enemyIdx].ubOnScreen = FALSE;
                s_ubActiveEnemies--;
                logWrite("[%d] End of Path => Active: %d", enemyIdx, s_ubActiveEnemies);
                continue;
            }
        }

        UWORD uwPathIdx = s_tEnemy[enemyIdx].uwPathArrayOffset + s_tEnemy[enemyIdx].uwPathIdx;
        s_tEnemy[enemyIdx].tPosition.uwX = s_uwPathData[uwPathIdx];
        s_tEnemy[enemyIdx].tPosition.uwY = s_uwPathData[uwPathIdx+1] + s_tEnemy[enemyIdx].uwPathYOffset;
        s_tEnemy[enemyIdx].sBob.sPos = s_tEnemy[enemyIdx].tPosition;

        // Check X bounds
        if ((s_tEnemy[enemyIdx].tPosition.uwX+s_tEnemyTypes[ubEnemyType].ubWidth) < uwCameraXMin || s_tEnemy[enemyIdx].tPosition.uwX > uwCameraXMax)
        {
            s_tEnemy[enemyIdx].ubOnScreen = FALSE;
            continue;
        }

        // Check Y bounds
        //if ((s_tEnemy[enemyIdx].tPosition.uwY+s_tEnemyTypes[ubEnemyType].ubHeight)-1 < uwCameraYMin)
        if (s_tEnemy[enemyIdx].tPosition.uwY+8 < uwCameraYMin)
        {
            s_tEnemy[enemyIdx].ubOnScreen = FALSE;
            continue;
        }

        // Remove if below camera Y bounds.
        if (s_tEnemy[enemyIdx].tPosition.uwY >= uwCameraYMax) {
            s_tEnemy[enemyIdx].ubOnScreen = FALSE;
            s_tEnemy[enemyIdx].bHealth = 0;
            s_ubActiveEnemies--;
            logWrite("[%d] Below camera => Active: %d", enemyIdx, s_ubActiveEnemies);
            continue;
        }

        // Enemy is on screen.
        s_tEnemy[enemyIdx].ubOnScreen = TRUE;

        if (s_tEnemy[enemyIdx].ubInvincible == TRUE) {
            if (s_tEnemy[enemyIdx].tPosition.uwY > uwCameraYMin+16) {
                s_tEnemy[enemyIdx].ubInvincible = FALSE;
            }
        }

        #ifndef COLLISIONS_DISABLED
        // Check collision with player.
        if (s_ubPlayerAlive == TRUE) {
            UBYTE ubCollision = checkCollision(s_tPlayerPosition.uwX+PLAYER_HITBOX_OFFSET_X, s_tPlayerPosition.uwY+PLAYER_HITBOX_OFFSET_Y, PLAYER_HITBOX_WIDTH, PLAYER_HITBOX_HEIGHT, 
                                               s_tEnemy[enemyIdx].tPosition.uwX, s_tEnemy[enemyIdx].tPosition.uwY, s_tEnemyTypes[ubEnemyType].ubWidth, s_tEnemyTypes[ubEnemyType].ubHeight);
            if (ubCollision == TRUE) { 
                processPlayerDie();
            }
        }
        #endif

        // Fire projectile.
        if (s_tEnemy[enemyIdx].ubCanShoot == FALSE || s_ubPlayerAlive == FALSE) { continue; }

        s_tEnemy[enemyIdx].ubCooldownTimer--;

        if (s_tEnemy[enemyIdx].ubCooldownTimer == 0) {
            s_tEnemy[enemyIdx].ubCooldownTimer = s_tEnemyTypes[ubEnemyType].ubCooldownTime;
            UBYTE ubProjectileType = s_tEnemyTypes[ubEnemyType].ubProjectileType;

            if (ubProjectileType == 0) {
                for (UBYTE i=0; i<ENEMY_PROJECTILE_MAX; i++) {
                    if (s_tSimpleEnemyProjectiles[i].ubAlive == 0) {
                        UWORD uwEnemyGunX = s_tEnemy[enemyIdx].tPosition.uwX + s_tEnemyTypes[ubEnemyType].ubGunOffsetX;
                        UWORD uwEnemyGunY = s_tEnemy[enemyIdx].tPosition.uwY + s_tEnemyTypes[ubEnemyType].ubGunOffsetY;
                        s_tSimpleEnemyProjectiles[i].uwX = uwEnemyGunX - (s_tEnemyProjectileTypes[ubProjectileType].ubOffset);
                        s_tSimpleEnemyProjectiles[i].uwY = uwEnemyGunY;
                        s_tSimpleEnemyProjectiles[i].bDeltaX = 0;
                        s_tSimpleEnemyProjectiles[i].bDeltaY = s_tEnemyProjectileTypes[ubProjectileType].bSpeed;
                        s_tSimpleEnemyProjectiles[i].ubAlive = 255;
                        s_tSimpleEnemyProjectiles[i].ubChannel = 255;
                        s_tSimpleEnemyProjectiles[i].ubType = ubProjectileType;
                        break;
                    }
                }
            } else {
                for (UBYTE i=0; i<ENEMY_PROJECTILE_MAX; i++) {
                    if (s_tComplexEnemyProjectiles[i].ubAlive == 0) {
                        UWORD uwEnemyGunX = s_tEnemy[enemyIdx].tPosition.uwX + s_tEnemyTypes[ubEnemyType].ubGunOffsetX;
                        UWORD uwEnemyGunY = s_tEnemy[enemyIdx].tPosition.uwY + s_tEnemyTypes[ubEnemyType].ubGunOffsetY;
                        UWORD uwPlayerCenterX = s_tPlayerPosition.uwX + PLAYER_CENTER_OFFSET_X;
                        UWORD uwPlayerCenterY = s_tPlayerPosition.uwY + PLAYER_CENTER_OFFSET_Y;

                        UBYTE ubAngle = getAngleBetweenPoints(uwEnemyGunX, uwEnemyGunY, uwPlayerCenterX, uwPlayerCenterY);
                        s_tComplexEnemyProjectiles[i].fX = fix16_from_int(uwEnemyGunX);
                        s_tComplexEnemyProjectiles[i].fY = fix16_from_int(uwEnemyGunY);
                        s_tComplexEnemyProjectiles[i].fDeltaX = ccos(ubAngle) * s_tEnemyProjectileTypes[ubProjectileType].bSpeed;
                        s_tComplexEnemyProjectiles[i].fDeltaY = csin(ubAngle) * s_tEnemyProjectileTypes[ubProjectileType].bSpeed;
                        s_tComplexEnemyProjectiles[i].ubAlive = 255;
                        s_tComplexEnemyProjectiles[i].ubChannel = 255;
                        s_tComplexEnemyProjectiles[i].ubType = ubProjectileType;

                        if (s_tComplexEnemyProjectiles[i].fDeltaX == 0 && s_tComplexEnemyProjectiles[i].fDeltaY == 0) {
                            s_tComplexEnemyProjectiles[i].ubAlive = 0;
                        }
                        
                        break;
                    }
                }
            }
        }
    }
}

static void processPlayerDie() {
    if (s_ubPlayerIsInvincible == TRUE) { return; }
    s_tBigExplosionBob.sPos.uwX = s_tPlayerPosition.uwX - 8;
    s_tBigExplosionBob.sPos.uwY = s_tPlayerPosition.uwY - 8;
    s_ubBigExplosionActive = 1;
    audioMixerPlaySfx(s_pSfxExplosion, CHANNEL_FOR_EXPLOSION, 10, 0);
    s_ubPlayerAlive = FALSE;
    if (s_ubPlayerLives != 0) { s_ubPlayerLives--; }
    s_ubUpdateLives = TRUE;
    s_ubEquippedProjectileType = 0;    
    s_ubUpdatePower = TRUE;

    for (UBYTE i=0; i<ENEMY_PROJECTILE_MAX; i++) {
        if (s_tSimpleEnemyProjectiles[i].ubAlive > 0) { s_tSimpleEnemyProjectiles[i].ubAlive = 1; }
        if (s_tComplexEnemyProjectiles[i].ubAlive > 0) { s_tComplexEnemyProjectiles[i].ubAlive = 1; }
    }
}

static void processPlayerShoot() {

    // if (s_ubPlayerAlive == FALSE && s_ubShowTextGameOverTimer == 0) {
    //     resetEverything();
    // }

    if (s_ubFireDelay == 0 && s_ubPlayerAlive == TRUE) {
        for (UBYTE i=0; i<PLAYER_PROJECTILE_MAX; i++) {
            if (s_tPlayerProjectiles[i].ubAlive == 0) {
                s_ubFireDelay = s_tPlayerProjectileTypes[s_ubEquippedProjectileType].ubDelay;

                s_tPlayerProjectiles[i].uwX = (s_tPlayerPosition.uwX + s_tPlayerProjectileTypes[s_ubEquippedProjectileType].ubXOffset);
                s_tPlayerProjectiles[i].uwY = (s_tPlayerPosition.uwY - s_tPlayerProjectileTypes[s_ubEquippedProjectileType].ubHeight);
                s_tPlayerProjectiles[i].ubAlive = 1;
                s_tPlayerProjectiles[i].ubType = s_ubEquippedProjectileType;

                // if (s_tPlayerProjectileTypes[s_ubEquippedProjectileType].ubWideSprite == TRUE || s_tPlayerProjectileTypes[s_ubEquippedProjectileType].ubSpreadShot == TRUE) {
                //     s_tPlayerSecondaryProjectiles[i].uwX = (s_tPlayerPosition.uwX + s_tPlayerProjectileTypes[s_ubEquippedProjectileType].ubXOffset2);
                //     s_tPlayerSecondaryProjectiles[i].ubType = s_ubEquippedProjectileType;
                // }

                if (s_ubAudioDelay == 0) {
                    switch (s_ubEquippedProjectileType) {
                        case 0:
                            audioMixerPlaySfx(s_pSfxLightLaser, CHANNEL_FOR_PLAYER, 8, 0);
                            break;
                        case 1:
                            audioMixerPlaySfx(s_pSfxLightLaser, CHANNEL_FOR_PLAYER, 8, 0);
                            break;
                        case 2:
                            audioMixerPlaySfx(s_pSfxHeavyLaser, CHANNEL_FOR_PLAYER, 8, 0);
                            break;
                        case 3:
                            audioMixerPlaySfx(s_pSfxFastLaser, CHANNEL_FOR_PLAYER, 8, 0);
                            break;                                                                                    
                    }
                    
                    s_ubAudioDelay = PLAYER_AUDIO_DELAY;
                }

                break;
            }
        }
    }    
}

static void processPlayerSpecial() {
    if (s_ubSpecialDelay == 0 && s_ubPlayerAlive == TRUE) {
        if (s_ubPlayerSpecial > 0) {
            // TODO: Play SFX here
            s_ubPlayerSpecial--;
            s_ubUpdateSpecial = TRUE;
            s_ubSpecialDelay = PLAYER_SPECIAL_DELAY;

            s_ubPlayerIsInvincible = TRUE;
            s_ubPlayerInvincibleTimer = PLAYER_INVINCIBLE_TIME;

            for (UBYTE enemyIdx=0; enemyIdx<ENEMY_MAX; enemyIdx++) {
                if (s_tEnemy[enemyIdx].bHealth > 0) {
                    // TODO: Check if on screen
                    s_tEnemy[enemyIdx].bHealth -= PLAYER_SPECIAL_DAMAGE;

                    // Enemy is dead.
                    if (s_tEnemy[enemyIdx].bHealth <= 0) {
                        s_tEnemy[enemyIdx].bHealth = 0;
                        createExplosionAtPosition(s_tEnemy[enemyIdx].tPosition);                      
                        s_ulPlayerScore += s_tEnemy[enemyIdx].uwScoreValue;
                        s_ubUpdateScore = TRUE;
                        s_ubActiveEnemies--;
                        logWrite("[%d] Killed by Special at (%d,%d) => Active: %d", enemyIdx, s_tEnemy[enemyIdx].tPosition.uwX, s_tEnemy[enemyIdx].tPosition.uwY, s_ubActiveEnemies);
                    }
                }
            }
        }
    }
}

static void processPlayerProjectiles() {
    UWORD uwCameraYMin = s_pCamera->uPos.uwY;
    UWORD uwCameraYMax = s_pCamera->uPos.uwY+TILE_VIEWPORT_HEIGHT;
    UWORD uwCameraXMin = TILE_VIEWPORT_XMIN;
    UWORD uwCameraXMax = TILE_VIEWPORT_XMAX;

    for (UBYTE projectileIdx=0; projectileIdx<PLAYER_PROJECTILE_MAX; projectileIdx++) {
        if (s_tPlayerProjectiles[projectileIdx].ubAlive != 0) {
            UWORD uwX = s_tPlayerProjectiles[projectileIdx].uwX;
            UWORD uwY = s_tPlayerProjectiles[projectileIdx].uwY;
            UBYTE ubType = s_tPlayerProjectiles[projectileIdx].ubType;
            BYTE bDeltaX = s_tPlayerProjectileTypes[ubType].bDeltaX;
            BYTE bDeltaY = s_tPlayerProjectileTypes[ubType].bDeltaY;
            UBYTE ubWidth = s_tPlayerProjectileTypes[ubType].ubWidth;
            UBYTE ubHeight = s_tPlayerProjectileTypes[ubType].ubHeight;
            UBYTE ubDamage = s_tPlayerProjectileTypes[ubType].ubDamage;
            UBYTE ubDieOnCollision = s_tPlayerProjectileTypes[ubType].ubDieOnCollision;
            
            //UWORD uwX2 = 0;
            //BYTE bDeltaX2 = s_tPlayerProjectileTypes[ubType].bDeltaX2;            
            //UBYTE ubSecondarySpriteIndex = s_tPlayerProjectileTypes[ubType].ubSecondarySpriteIndex;
            //UBYTE ubWideSprite = s_tPlayerProjectileTypes[ubType].ubWideSprite;
            //UBYTE ubSpreadShot = s_tPlayerProjectileTypes[ubType].ubSpreadShot;
            //UBYTE ubHasSecondary = FALSE;
            // if (ubWideSprite || ubSpreadShot) {
            //     ubHasSecondary = TRUE;
            //     uwX2 = s_tPlayerSecondaryProjectiles[projectileIdx].uwX;
            // }

            // Check if projectile if off screen.
            //if (uwY < (uwCameraYMin-ubHeight) || uwX < (uwCameraXMin-ubWidth) || uwX > uwCameraXMax) {
            if (uwY < (uwCameraYMin-ubHeight)) {
                s_tPlayerProjectiles[projectileIdx].ubAlive = 0;
                movePlayerProjectile(s_tPlayerProjectiles[projectileIdx].pCopBlock, -16, -16, ubHeight, PLAYER_SPRITE_CHANNEL_A, ubType);

                //movePlayerProjectile(s_tPlayerProjectiles[projectileIdx].pCopBlock, -16, -16, ubHeight, PLAYER_SPRITE_CHANNEL_A, ubType, FALSE);
                // if (ubHasSecondary) {
                //     movePlayerProjectile(s_tPlayerSecondaryProjectiles[projectileIdx].pCopBlock, -16, -16, ubHeight, PLAYER_SPRITE_CHANNEL_B, ubSecondarySpriteIndex, TRUE); 
                // }

                continue;
            }

            // Check collisions
            #ifndef COLLISIONS_DISABLED
            for (UBYTE enemyIdx=0; enemyIdx<ENEMY_MAX; enemyIdx++) {
                if (s_tEnemy[enemyIdx].bHealth <= 0) { continue; }

                // Get EnemyType
                UBYTE ubEnemyType = s_tEnemy[enemyIdx].ubEnemyType;

                // Check if enemy is on screen.
                if (s_tEnemy[enemyIdx].tPosition.uwX+s_tEnemyTypes[ubEnemyType].ubWidth < uwCameraXMin || s_tEnemy[enemyIdx].tPosition.uwX > uwCameraXMax) { continue; }
                if (s_tEnemy[enemyIdx].tPosition.uwY+s_tEnemyTypes[ubEnemyType].ubHeight < uwCameraYMin || s_tEnemy[enemyIdx].tPosition.uwY > uwCameraYMax) { continue; }

                // TODO: Rethink this approach, ends up basically doing collision detection twice. Unroll into individual checks? Include checks in checkCollision()?

                // Check if projectile is to far to the left of the enemy
                if (s_tEnemy[enemyIdx].tPosition.uwX+s_tEnemyTypes[ubEnemyType].ubWidth < uwX) { continue; }

                // Check if projectile is to far to the right of the enemy
                if (s_tEnemy[enemyIdx].tPosition.uwX > uwX+ubWidth) { continue; }

                // Check if projectile is above enemy
                if (s_tEnemy[enemyIdx].tPosition.uwY > uwY+(ubHeight+bDeltaY)) { continue; }

                // Test collision
                UBYTE ubCollision = checkCollision(uwX, uwY-bDeltaY, ubWidth, ubHeight, s_tEnemy[enemyIdx].tPosition.uwX, s_tEnemy[enemyIdx].tPosition.uwY, s_tEnemyTypes[ubEnemyType].ubWidth, s_tEnemyTypes[ubEnemyType].ubHeight);

                // Check spread shot collision
                // if (ubSpreadShot == TRUE) {
                //     UBYTE ubSpreadCollision = checkCollision(uwX, uwY+bDeltaY, ubWidth, ubHeight, s_tEnemy[enemyIdx].tPosition.wX, s_tEnemy[enemyIdx].tPosition.wY, ENEMY_WIDTH, ENEMY_HEIGHT);
                // }

                if (ubCollision == FALSE) { continue; }

                // Damage enemy
                if (s_tEnemy[enemyIdx].ubInvincible == FALSE) {
                    s_tEnemy[enemyIdx].bHealth -= ubDamage;
                }

                // Remove projectile?
                if (ubDieOnCollision == TRUE) {
                    s_tPlayerProjectiles[projectileIdx].ubAlive = 0;
                }

                // Enemy is dead.
                if (s_tEnemy[enemyIdx].bHealth <= 0) {
                    s_tEnemy[enemyIdx].bHealth = 0;
                    createExplosionAtPosition(s_tEnemy[enemyIdx].tPosition);

                    if (s_tEnemy[enemyIdx].ubPowerupType > 0) {
                        createPowerupAtPosition(s_tEnemy[enemyIdx].tPosition, s_tEnemy[enemyIdx].ubPowerupType);
                    }
                    
                    s_ulPlayerScore += s_tEnemy[enemyIdx].uwScoreValue;
                    s_ubUpdateScore = TRUE;
                    s_ubActiveEnemies--;
                    logWrite("[%d] Killed by Player at (%d,%d) => Active: %d", enemyIdx, s_tEnemy[enemyIdx].tPosition.uwX, s_tEnemy[enemyIdx].tPosition.uwY, s_ubActiveEnemies);
                }
            }
            #endif

            if (s_tPlayerProjectiles[projectileIdx].ubAlive == 0) {
                movePlayerProjectile(s_tPlayerProjectiles[projectileIdx].pCopBlock, -16, -16, ubHeight, PLAYER_SPRITE_CHANNEL_A, ubType);
                //movePlayerProjectile(s_tPlayerProjectiles[projectileIdx].pCopBlock, -16, -16, ubHeight, PLAYER_SPRITE_CHANNEL_A, ubType, FALSE);
                // if (ubHasSecondary) { 
                //     movePlayerProjectile(s_tPlayerSecondaryProjectiles[projectileIdx].pCopBlock, -16, -16, ubHeight, PLAYER_SPRITE_CHANNEL_B, ubSecondarySpriteIndex, TRUE); 
                // }
                continue;
            }

            UWORD uwScreenY = (uwY - s_pCamera->uPos.uwY);
            UWORD uwScreenX = (uwX - TILE_VIEWPORT_XMIN);

            movePlayerProjectile(s_tPlayerProjectiles[projectileIdx].pCopBlock, uwScreenX, uwScreenY, ubHeight, PLAYER_SPRITE_CHANNEL_A, ubType);
            //movePlayerProjectile(s_tPlayerProjectiles[projectileIdx].pCopBlock, uwScreenX, uwScreenY, ubHeight, PLAYER_SPRITE_CHANNEL_A, ubType, FALSE);

            // Secondary projectile
            // if (ubHasSecondary) {
            //     movePlayerProjectile(s_tPlayerSecondaryProjectiles[projectileIdx].pCopBlock, uwX2, uwScreenY, ubHeight, PLAYER_SPRITE_CHANNEL_B, ubSecondarySpriteIndex, TRUE);
            // }

            // Move projectile
            if (bDeltaX != 0) {
                s_tPlayerProjectiles[projectileIdx].uwX += bDeltaX;
                //s_tPlayerSecondaryProjectiles[projectileIdx].uwX += bDeltaX2;
            }
            
            s_tPlayerProjectiles[projectileIdx].uwY += bDeltaY;
        }
    }
}

static void processSimpleEnemyProjectiles() {
    UWORD uwCameraYMin = s_pCamera->uPos.uwY;
    UWORD uwCameraXMin = TILE_VIEWPORT_XMIN;
    UWORD uwCameraXMax = TILE_VIEWPORT_XMAX;
    s_ubProjectileBobIndex = 0;

    s_tSimpleChannelBounds[0] = (tSimpleChannelBounds){.uwMin = BOUNDS_MAX, .uwMax = BOUNDS_MIN};
    s_tSimpleChannelBounds[1] = (tSimpleChannelBounds){.uwMin = BOUNDS_MAX, .uwMax = BOUNDS_MIN};
    s_tSimpleChannelBounds[2] = (tSimpleChannelBounds){.uwMin = BOUNDS_MAX, .uwMax = BOUNDS_MIN};
    s_tSimpleChannelBounds[3] = (tSimpleChannelBounds){.uwMin = BOUNDS_MAX, .uwMax = BOUNDS_MIN};

    for (UBYTE projectileIdx=0; projectileIdx<ENEMY_PROJECTILE_MAX; projectileIdx++) {
        if (s_tSimpleEnemyProjectiles[projectileIdx].ubAlive == 0) { continue; }

        UBYTE ubEnemyProjectileType = s_tSimpleEnemyProjectiles[projectileIdx].ubType;
        UBYTE ubEnemyProjectileWidth = s_tEnemyProjectileTypes[ubEnemyProjectileType].ubWidth;
        UBYTE ubEnemyProjectileHeight = s_tEnemyProjectileTypes[ubEnemyProjectileType].ubHeight;
        UWORD uwCameraYMax = (s_pCamera->uPos.uwY+TILE_VIEWPORT_HEIGHT) - ubEnemyProjectileHeight;

        s_tSimpleEnemyProjectiles[projectileIdx].uwY += s_tSimpleEnemyProjectiles[projectileIdx].bDeltaY;
        s_tSimpleEnemyProjectiles[projectileIdx].ubAlive--;

        if (s_tSimpleEnemyProjectiles[projectileIdx].uwX < uwCameraXMin || s_tSimpleEnemyProjectiles[projectileIdx].uwX > uwCameraXMax) {
            s_tSimpleEnemyProjectiles[projectileIdx].ubAlive = 0;
        }

        if (s_tSimpleEnemyProjectiles[projectileIdx].uwY < uwCameraYMin || s_tSimpleEnemyProjectiles[projectileIdx].uwY > uwCameraYMax) {
            s_tSimpleEnemyProjectiles[projectileIdx].ubAlive = 0;
        }

        #ifndef COLLISIONS_DISABLED
        // Check collision with player.
        UBYTE ubCollision = checkCollision(s_tPlayerPosition.uwX+PLAYER_HITBOX_OFFSET_X, s_tPlayerPosition.uwY+PLAYER_HITBOX_OFFSET_Y, PLAYER_HITBOX_WIDTH, PLAYER_HITBOX_HEIGHT, 
                                           s_tSimpleEnemyProjectiles[projectileIdx].uwX, s_tSimpleEnemyProjectiles[projectileIdx].uwY, ubEnemyProjectileWidth, ubEnemyProjectileHeight);
        if (ubCollision == TRUE && s_ubPlayerAlive == TRUE) { 
            s_tComplexEnemyProjectiles[projectileIdx].ubAlive = 0;
            processPlayerDie();
        }
        #endif

        if (s_tSimpleEnemyProjectiles[projectileIdx].ubAlive == 0) {
            moveEnemyProjectile(s_tSimpleEnemyProjectiles[projectileIdx].pCopBlock, -16, -16, ubEnemyProjectileHeight, 0, s_tSimpleEnemyProjectiles[projectileIdx].ubType);
            s_tSimpleEnemyProjectiles[projectileIdx].ubChannel = 255;
            continue;
        }

        s_tSimpleEnemyProjectiles[projectileIdx].ubChannel = 255;
        UWORD uwSpriteYMin = s_tSimpleEnemyProjectiles[projectileIdx].uwY;
        UWORD uwSpriteYMax = s_tSimpleEnemyProjectiles[projectileIdx].uwY + ubEnemyProjectileHeight;

        for (UBYTE channelIdx=0; channelIdx<ENEMY_SPRITE_CHANNELS; channelIdx++)
        {
            if(uwSpriteYMax < s_tSimpleChannelBounds[channelIdx].uwMin)
            {
                s_tSimpleEnemyProjectiles[projectileIdx].ubChannel = channelIdx;
                s_tSimpleChannelBounds[channelIdx].uwMin = uwSpriteYMin;
                if(s_tSimpleChannelBounds[channelIdx].uwMax <= BOUNDS_MIN) {
                    s_tSimpleChannelBounds[channelIdx].uwMax = uwSpriteYMax;
                }
                break;
            }
            else if (uwSpriteYMin > s_tSimpleChannelBounds[channelIdx].uwMax)
            {
                s_tSimpleEnemyProjectiles[projectileIdx].ubChannel = channelIdx;
                if(s_tSimpleChannelBounds[channelIdx].uwMin >= BOUNDS_MAX) {
                    s_tSimpleChannelBounds[channelIdx].uwMin = uwSpriteYMin;
                }
                s_tSimpleChannelBounds[channelIdx].uwMax = uwSpriteYMax;
                break;
            }
        }

        if (s_tSimpleEnemyProjectiles[projectileIdx].ubChannel == 255) {
            moveEnemyProjectile(s_tSimpleEnemyProjectiles[projectileIdx].pCopBlock, -16, -16, ubEnemyProjectileHeight, 0, s_tSimpleEnemyProjectiles[projectileIdx].ubType);

            if (s_ubProjectileBobIndex < ENEMY_SPRITE_CHANNELS) {
                s_tEnemyProjectileBob[s_ubProjectileBobIndex].sPos.uwX = s_tSimpleEnemyProjectiles[projectileIdx].uwX;
                s_tEnemyProjectileBob[s_ubProjectileBobIndex].sPos.uwY = s_tSimpleEnemyProjectiles[projectileIdx].uwY;
                s_ubEnemyProjectileBobTypes[s_ubProjectileBobIndex] = s_tSimpleEnemyProjectiles[projectileIdx].ubType;
                s_ubProjectileBobIndex++;
                continue;
            } else {
                s_tSimpleEnemyProjectiles[projectileIdx].ubAlive = 0;
                continue;
            }
        }

        moveEnemyProjectile(s_tSimpleEnemyProjectiles[projectileIdx].pCopBlock, 
                            ((s_tSimpleEnemyProjectiles[projectileIdx].uwX-TILE_VIEWPORT_XMIN)+80), 
                            (s_tSimpleEnemyProjectiles[projectileIdx].uwY - s_pCamera->uPos.uwY), 
                            ubEnemyProjectileHeight, 
                            s_tSimpleEnemyProjectiles[projectileIdx].ubChannel, 
                            ubEnemyProjectileType);
    }
}

static void processComplexEnemyProjectiles() {
    fix16_t fCameraYMin = fix16_from_int(s_pCamera->uPos.uwY);
    fix16_t fCameraXMin = s_fViewportXMin;
    fix16_t fCameraXMax = s_fViewportXMax;

    s_ubProjectileBobIndex = 0;
    s_fComplexChannelBounds[0] = (tComplexChannelBounds){.fMin = fix16_from_int(s_tSimpleChannelBounds[0].uwMin), .fMax = fix16_from_int(s_tSimpleChannelBounds[0].uwMax)};
    s_fComplexChannelBounds[1] = (tComplexChannelBounds){.fMin = fix16_from_int(s_tSimpleChannelBounds[1].uwMin), .fMax = fix16_from_int(s_tSimpleChannelBounds[1].uwMax)};
    s_fComplexChannelBounds[2] = (tComplexChannelBounds){.fMin = fix16_from_int(s_tSimpleChannelBounds[2].uwMin), .fMax = fix16_from_int(s_tSimpleChannelBounds[2].uwMax)};
    s_fComplexChannelBounds[3] = (tComplexChannelBounds){.fMin = fix16_from_int(s_tSimpleChannelBounds[3].uwMin), .fMax = fix16_from_int(s_tSimpleChannelBounds[3].uwMax)};

    for (UBYTE projectileIdx=0; projectileIdx<ENEMY_PROJECTILE_MAX; projectileIdx++) {
        if (s_tComplexEnemyProjectiles[projectileIdx].ubAlive == 0) { continue; }
        
        UBYTE ubEnemyProjectileType = s_tComplexEnemyProjectiles[projectileIdx].ubType;
        UBYTE ubEnemyProjectileWidth = s_tEnemyProjectileTypes[ubEnemyProjectileType].ubWidth;
        UBYTE ubEnemyProjectileHeight = s_tEnemyProjectileTypes[ubEnemyProjectileType].ubHeight;

        s_tComplexEnemyProjectiles[projectileIdx].fX = fix16_add(s_tComplexEnemyProjectiles[projectileIdx].fX, s_tComplexEnemyProjectiles[projectileIdx].fDeltaX);
        s_tComplexEnemyProjectiles[projectileIdx].fY = fix16_add(s_tComplexEnemyProjectiles[projectileIdx].fY, s_tComplexEnemyProjectiles[projectileIdx].fDeltaY);
        s_tComplexEnemyProjectiles[projectileIdx].ubAlive--;

        fix16_t fCameraYMax = fix16_from_int((s_pCamera->uPos.uwY+TILE_VIEWPORT_HEIGHT)-ubEnemyProjectileHeight);

        // Check X bounds
        if (s_tComplexEnemyProjectiles[projectileIdx].fX < fCameraXMin || s_tComplexEnemyProjectiles[projectileIdx].fX > fCameraXMax)
        {
            s_tComplexEnemyProjectiles[projectileIdx].ubAlive = 0;
        }

        // Check Y bounds
        if (s_tComplexEnemyProjectiles[projectileIdx].fY < fCameraYMin || s_tComplexEnemyProjectiles[projectileIdx].fY > fCameraYMax)
        {
            s_tComplexEnemyProjectiles[projectileIdx].ubAlive = 0;
        }

        if (s_tComplexEnemyProjectiles[projectileIdx].ubAlive == 0) {
            moveEnemyProjectile(s_tComplexEnemyProjectiles[projectileIdx].pCopBlock, -16, -16, ubEnemyProjectileHeight, 0, ubEnemyProjectileType);
            s_tComplexEnemyProjectiles[projectileIdx].ubChannel = 255;
            continue;
        }

        #ifndef COLLISIONS_DISABLED
        // Check collision with player.
        UBYTE ubCollision = checkCollision(s_tPlayerPosition.uwX+PLAYER_HITBOX_OFFSET_X, s_tPlayerPosition.uwY+PLAYER_HITBOX_OFFSET_Y, PLAYER_HITBOX_WIDTH, PLAYER_HITBOX_HEIGHT, 
                                           fix16_to_int(s_tComplexEnemyProjectiles[projectileIdx].fX), fix16_to_int(s_tComplexEnemyProjectiles[projectileIdx].fY), ubEnemyProjectileWidth, ubEnemyProjectileHeight);
        if (ubCollision == TRUE && s_ubPlayerAlive == TRUE) { 
            s_tComplexEnemyProjectiles[projectileIdx].ubAlive = 0;
            s_tComplexEnemyProjectiles[projectileIdx].ubChannel = 255;
            moveEnemyProjectile(s_tComplexEnemyProjectiles[projectileIdx].pCopBlock, -16, -16, ubEnemyProjectileHeight, 0, ubEnemyProjectileType);
            processPlayerDie();
            continue;
        }
        #endif

        s_tComplexEnemyProjectiles[projectileIdx].ubChannel = 255;
        fix16_t fSpriteYMin = s_tComplexEnemyProjectiles[projectileIdx].fY;
        fix16_t fSpriteYMax = fix16_add(fSpriteYMin, fix16_from_int(ubEnemyProjectileHeight));

        for (UBYTE channelIdx=0; channelIdx<ENEMY_SPRITE_CHANNELS; channelIdx++)
        {
            if(fSpriteYMax < s_fComplexChannelBounds[channelIdx].fMin)
            {
                // logWrite("before %d: %ld < %ld", channelIdx, fSpriteYMax, fChannelY);
                s_tComplexEnemyProjectiles[projectileIdx].ubChannel = channelIdx;
                s_fComplexChannelBounds[channelIdx].fMin = fSpriteYMin;
                if(s_fComplexChannelBounds[channelIdx].fMax == s_fBoundsMin) {
                    s_fComplexChannelBounds[channelIdx].fMax = fSpriteYMax;
                }
                break;
            }
            else if (fSpriteYMin > s_fComplexChannelBounds[channelIdx].fMax)
            {
                // logWrite("after %d: %ld > %ld", channelIdx, fSpriteY, fChannelYMax);
                s_tComplexEnemyProjectiles[projectileIdx].ubChannel = channelIdx;
                if(s_fComplexChannelBounds[channelIdx].fMin == s_fBoundsMax) {
                    s_fComplexChannelBounds[channelIdx].fMin = fSpriteYMin;
                }
                s_fComplexChannelBounds[channelIdx].fMax = fSpriteYMax;
                break;
            }
        }

        if (s_tComplexEnemyProjectiles[projectileIdx].ubChannel == 255) {
            moveEnemyProjectile(s_tComplexEnemyProjectiles[projectileIdx].pCopBlock, -16, -16, ubEnemyProjectileHeight, 0, ubEnemyProjectileType);

            if (s_ubProjectileBobIndex < ENEMY_SPRITE_CHANNELS) {
                s_tEnemyProjectileBob[s_ubProjectileBobIndex].sPos.uwX = fix16_to_int(s_tComplexEnemyProjectiles[projectileIdx].fX);
                s_tEnemyProjectileBob[s_ubProjectileBobIndex].sPos.uwY = fix16_to_int(s_tComplexEnemyProjectiles[projectileIdx].fY);
                s_ubProjectileBobIndex++;
                continue;
            } else {
                s_tComplexEnemyProjectiles[projectileIdx].ubAlive = 0;
                continue;
            }
        }

        moveEnemyProjectile(s_tComplexEnemyProjectiles[projectileIdx].pCopBlock, 
                            ((fix16_to_int(s_tComplexEnemyProjectiles[projectileIdx].fX) - TILE_VIEWPORT_XMIN)+80), 
                            (fix16_to_int(s_tComplexEnemyProjectiles[projectileIdx].fY) - s_pCamera->uPos.uwY), 
                            ubEnemyProjectileHeight, 
                            s_tComplexEnemyProjectiles[projectileIdx].ubChannel, 
                            ubEnemyProjectileType);
    }    
}

// Utility functions.

static void resetEverything() {
    s_ubDimLevel = 0;
    s_ubFrameCounter = 0;
    s_ubFlashTimer = 0;
    s_ubFlashOn = FALSE;
    s_ubLevelStart = TRUE;
    s_ubLevelStartTimer = 128;
    s_ubCameraCanMove = FALSE;
    s_ubMoveCameraCounter = 0;
    s_ubCurrentLevel = 0;
    s_ulPlayerScore = 0; 
    s_ubPlayerLives = PLAYER_LIVES_START;
    s_ubPlayerSpecial = PLAYER_SPECIAL_START;
    s_ubUpdateScore = TRUE;
    s_ubUpdatePower = TRUE;
    s_ubUpdateLives = TRUE;
    s_ubUpdateSpecial = TRUE;
    s_ubEngineAnimFrame = 0;
    s_ubFireDelay = 0;
    s_ubSpecialDelay = 0;
    s_ubAudioDelay = 0;
    s_ubEquippedProjectileType = 0;
    s_ubPlayerAlive = FALSE;
    s_ubPlayerMovedLeft = FALSE;
    s_ubPlayerMovedRight = FALSE;
    s_ubPlayerMovedOnY = FALSE;
    s_ubDisplayPlayer = TRUE;
    s_ubDisplayEngine = TRUE;
    s_ubPlayerIsInvincible = FALSE;
    s_ubPlayerInvincibleTimer = 0;
    s_ubWaveIndex = 0;
    s_ubActiveEnemies = 0;
    s_ubActiveExplosions = 0;
    s_ubBigExplosionActive = 0;
    s_ubBigExplosionFrame = 0;
    s_ubLifePowActive = FALSE;
    s_ubSpecialPowActive = FALSE;
    s_ubWeaponPowActive = FALSE;
    s_ubShowTextGameOver = FALSE;
    s_ubShowTextGameOverTimer = 255;
    s_ubShowTextReady = FALSE;
    s_ubShowTextGo = FALSE;

    for (UBYTE i=0; i<ENEMY_MAX; i++) {
        s_tEnemy[i].bHealth = 0;
    }

    for (UBYTE i=0; i<PLAYER_PROJECTILE_MAX; i++) {
        s_tPlayerProjectiles[i].ubAlive = 0;
    }

    for (UBYTE i=0; i<ENEMY_PROJECTILE_MAX; i++) {
        s_tSimpleEnemyProjectiles[i].ubAlive = 0;
        s_tComplexEnemyProjectiles[i].ubAlive = 0;
    }

    // for (UBYTE i=0; i<PLAYER_PROJECTILE_MAX; i++) {
    //     if (s_tPlayerProjectiles[i].ubAlive != 0) {
    //         UBYTE ubType = s_tPlayerProjectiles[i].ubType;
    //         UBYTE ubHeight = s_tPlayerProjectileTypes[ubType].ubHeight;
    //         movePlayerProjectile(s_tPlayerProjectiles[i].pCopBlock, -16, -16, ubHeight, PLAYER_SPRITE_CHANNEL_A, ubType);
    //         s_tPlayerProjectiles[i].ubAlive = 0;
    //     }
    // }

    // for (UBYTE i=0; i<ENEMY_PROJECTILE_MAX; i++) {
    //     if (s_tSimpleEnemyProjectiles[i].ubAlive != 0) {
    //         moveEnemyProjectile(s_tSimpleEnemyProjectiles[i].pCopBlock, -16, -16, ENEMY_SIMPLEPROJECTILE_HEIGHT, 0, 0);
    //         s_tSimpleEnemyProjectiles[i].ubAlive = 0;
    //     }
        
    //     if (s_tComplexEnemyProjectiles[i].ubAlive != 0) {
    //         UBYTE ubType = s_tSimpleEnemyProjectiles[i].ubType;
    //         UBYTE ubHeight = s_tEnemyProjectileTypes[ubType].ubHeight;            
    //         moveEnemyProjectile(s_tComplexEnemyProjectiles[i].pCopBlock, -16, -16, ubHeight, 0, 0);
    //         s_tComplexEnemyProjectiles[i].ubAlive = 0;
    //     }
    // }
}

//static void movePlayerProjectile(tCopBlock *pBlock, WORD wX, WORD wY, UWORD uwHeight, UBYTE ubChannel, UBYTE ubType, UBYTE ubSecondary) {
static void movePlayerProjectile(tCopBlock *pBlock, WORD wX, WORD wY, UWORD uwHeight, UBYTE ubChannel, UBYTE ubType) {
    UWORD uwVStart = s_pView->ubPosY + wY;
    UWORD uwVStop = uwVStart + uwHeight;
    UWORD uwHStart = (s_pView->ubPosX - 1) + wX;

    UWORD uwPos = ((uwVStart << 8) | ((uwHStart) >> 1));
    UWORD uwCtl = (UWORD) (
        (uwVStop << 8) |
        (0 << 7) |
        (BTST(uwVStart, 8) << 2) |
        (BTST(uwVStop, 8) << 1) |
        BTST(uwHStart, 0)
    );

    copBlockWait(s_pView->pCopList, pBlock, 0, s_pView->ubPosY + wY);

    pBlock->uwCurrCount = 0;
    ULONG ulAddr = 0;
    ulAddr = (ULONG)(
        (UBYTE*)s_pPlayerProjectileSprites[ubType]->pBitmap->Planes[0] +
        sizeof(g_pCustom->spr[ubChannel].pos) +
        sizeof(g_pCustom->spr[ubChannel].ctl)
    ); // skip the control words
        
    // if (ubSecondary == FALSE) {
    //     ulAddr = (ULONG)(
    //         (UBYTE*)s_pPlayerProjectileSprites[ubType]->pBitmap->Planes[0] +
    //         sizeof(g_pCustom->spr[ubChannel].pos) +
    //         sizeof(g_pCustom->spr[ubChannel].ctl)
    //     ); // skip the control words
    // } else {
    //     ulAddr = (ULONG)(
    //         (UBYTE*)s_pPlayerSecondaryProjectileSprites[ubType]->pBitmap->Planes[0] +
    //         sizeof(g_pCustom->spr[ubChannel].pos) +
    //         sizeof(g_pCustom->spr[ubChannel].ctl)
    //     );
    // }

    copMove(s_pView->pCopList, pBlock, &g_pSprFetch[ubChannel].uwHi, ulAddr >> 16);
    copMove(s_pView->pCopList, pBlock, &g_pSprFetch[ubChannel].uwLo, ulAddr & 0xFFFF);
    copMove(s_pView->pCopList, pBlock, &g_pCustom->spr[ubChannel].pos, uwPos);
    copMove(s_pView->pCopList, pBlock, &g_pCustom->spr[ubChannel].ctl, uwCtl);
}

static void moveEnemyProjectile(tCopBlock *pBlock, WORD wX, WORD wY, UWORD uwHeight, UBYTE ubChannel, UBYTE ubType) {
    UWORD uwVStart = s_pView->ubPosY + wY;
    UWORD uwVStop = uwVStart + uwHeight;
    UWORD uwHStart = 128 + wX;

    UWORD uwPos = ((uwVStart << 8) | ((uwHStart) >> 1));
    UWORD uwCtl = (UWORD) (
        (uwVStop << 8) |
        (0 << 7) |
        (BTST(uwVStart, 8) << 2) |
        (BTST(uwVStop, 8) << 1) |
        BTST(uwHStart, 0)
    );

    copBlockWait(s_pView->pCopList, pBlock, 0, s_pView->ubPosY + wY);

    pBlock->uwCurrCount = 0;
    ULONG ulAddr = (ULONG)(
        (UBYTE*)s_pEnemyProjectileSprite[ubType]->pBitmap->Planes[0] +
        sizeof(g_pCustom->spr[ubChannel].pos) +
        sizeof(g_pCustom->spr[ubChannel].ctl)
    ); // skip the control words

    copMove(s_pView->pCopList, pBlock, &g_pSprFetch[ubChannel].uwHi, ulAddr >> 16);
    copMove(s_pView->pCopList, pBlock, &g_pSprFetch[ubChannel].uwLo, ulAddr & 0xFFFF);
    copMove(s_pView->pCopList, pBlock, &g_pCustom->spr[ubChannel].pos, uwPos);
    copMove(s_pView->pCopList, pBlock, &g_pCustom->spr[ubChannel].ctl, uwCtl);
}

static void createPowerupAtPosition(tUwCoordYX tPosition, UBYTE ubPowerupType) {
    if (s_ubLifePowActive == TRUE || s_ubSpecialPowActive == TRUE || s_ubWeaponPowActive == TRUE) { return; } // Only one active powerups at a time.

    switch (ubPowerupType) {
        case POWERUP_EXTRALIFE: {
            s_tLifePowBob.sPos = tPosition;
            s_ubLifePowActive = TRUE;
            break;
        }
        case POWERUP_SPECIAL: {
            s_tSpecialPowBob.sPos = tPosition;
            s_ubSpecialPowActive = TRUE;
            break;
        }
        case POWERUP_WEAPON: {
            s_tWeaponPowBob.sPos = tPosition;
            s_ubWeaponPowActive = TRUE;
            break;
        }                
    }
}

static void createExplosionAtPosition(tUwCoordYX tPosition) {
    if (s_ubActiveExplosions < EXPLOSIONS_MAX) {
        UWORD uwCameraYMin = s_pCamera->uPos.uwY;
        UWORD uwCameraYMax = s_pCamera->uPos.uwY+TILE_VIEWPORT_HEIGHT;
        UWORD uwCameraXMin = TILE_VIEWPORT_XMIN;
        UWORD uwCameraXMax = TILE_VIEWPORT_XMAX;

        // Check X bounds
        if ((tPosition.uwX+EXPLOSION_WIDTH) < uwCameraXMin || tPosition.uwX > uwCameraXMax) { return; }

        // Check Y bounds
        if (tPosition.uwY+8 < uwCameraYMin || tPosition.uwY >= uwCameraYMax) { return; }

        for (UBYTE explosionIdx=0; explosionIdx < EXPLOSIONS_MAX; explosionIdx++) {
            if (s_tExplosions[explosionIdx].ubAlive != 0) { continue; }
            s_tExplosions[explosionIdx].sBob.sPos = tPosition;
            s_tExplosions[explosionIdx].ubAlive = 1;
            s_tExplosions[explosionIdx].ubFrameIndex = 0;
            s_ubActiveExplosions++;
            audioMixerPlaySfx(s_pSfxExplosion, CHANNEL_FOR_EXPLOSION, 8, 0);
            break;
        }
    }
}

static UBYTE checkCollision(WORD x1, WORD y1, UBYTE w1, UBYTE h1, WORD x2, WORD y2, UBYTE w2, UBYTE h2) {
    return x1 < x2+w2 && x1+w1 > x2 && y1 < y2+h2 && y1+h1 > y2;
}
